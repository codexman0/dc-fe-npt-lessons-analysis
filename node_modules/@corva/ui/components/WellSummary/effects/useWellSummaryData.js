import t from"@babel/runtime/helpers/defineProperty";import{get as r,sortBy as e,omit as n}from"lodash";import a from"@babel/runtime/helpers/slicedToArray";import s from"@babel/runtime/regenerator";import c from"@babel/runtime/helpers/asyncToGenerator";import"../../../constants/goals.js";import"../../../constants/apps.js";import"../../../constants/completion.js";import"../../../constants/segment.js";import"../../../constants/alerts.js";import{useState as i,useEffect as o}from"react";import{getAppStorage as u}from"../../../clients/jsonApi/index.js";import"../../../constants/drillstring.js";import{DRILLING_WELL_SUMMARY as p,COMPLETION_WELL_SUMMARY as l}from"../../../constants/wellSummary.js";import{RIG_ACTIVITY_COLORS as f}from"../../../constants/rigActivity.js";function m(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function h(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){t(r,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))}))}return r}function d(t){return v.apply(this,arguments)}function v(){return(v=c(s.mark((function t(e){var n,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map(function(){var t=c(s.mark((function t(e){var n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u("corva","activities.summary-continuous",e,{fields:["data.activities","data.start_timestamp","data.end_timestamp"].join(","),limit:1,query:"{timestamp#lte#".concat(Math.floor(Date.now()/1e3),"}"),sort:"{timestamp:-1}"});case 3:return n=t.sent,t.abrupt("return",(r(n,"0.data.activities")||[]).map((function(t){return h(h({},t),{},{duration:(t.day||0)+(t.night||0),color:f[t.name]})})));case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:return t.abrupt("return",[]);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(r){return t.apply(this,arguments)}}()));case 2:return n=t.sent,a={},n.forEach((function(t,r){a[e[r]]=t})),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t,r,e,n){return y.apply(this,arguments)}function y(){return(y=c(s.mark((function t(a,c,i,o){var p,l;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u("corva",c,a,{aggregate:JSON.stringify([{$match:{asset_id:a,timestamp:{$lte:i,$gte:i-86400}}},{$project:{_id:-1,stage_number:1,data:1,timestamp:1}},{$group:{_id:"$stage_number",timestamp:{$first:"$timestamp"},stage_number:{$last:"$stage_number"},first_data:{$first:"$data"},last_data:{$last:"$data"}}}])});case 3:return p=t.sent,l=0,e(p,"timestamp").forEach((function(t,e){if(0===e){var a=n(r(t,"first_data"),o),s=n(r(t,"last_data"),o);Object.keys(s).forEach((function(t){l+=s[t]-(a[t]||0)}))}else{var c=n(r(t,"last_data"),o);Object.keys(c).forEach((function(t){l+=c[t]}))}})),t.abrupt("return",l);case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:return t.abrupt("return",0);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}function g(t){return w.apply(this,arguments)}function w(){return(w=c(s.mark((function t(e){var n,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map(function(){var t=c(s.mark((function t(e){var n,c,i,o,p,l,f,m,h,d,v;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=Promise,t.next=4,u("corva","completion.wits",e,{limit:1,fields:"timestamp"});case 4:return t.t1=t.sent,t.next=7,u("corva","wireline.wits",e,{limit:1,fields:"timestamp"});case 7:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=11,t.t0.all.call(t.t0,t.t3);case 11:if(n=t.sent,c=a(n,2),i=c[0],o=c[1],p=r(i,"0.timestamp"),l=r(o,"0.timestamp"),f=null,p&&l?f=p>l?p:l:p?f=p:l&&(f=l),f){t.next=21;break}return t.abrupt("return",[]);case 21:return t.next=23,Promise.all([b(e,"completion.activity.summary-stage",f,["activities"]),b(e,"wireline.activity.summary-stage",f,["durations"])]);case 23:return m=t.sent,h=a(m,2),d=h[0],v=h[1],t.abrupt("return",[{name:"frac",duration:d,color:"#7177FF"},{name:"wireline",duration:v,color:"#FF9C00"}]);case 30:t.prev=30,t.t4=t.catch(0),console.error(t.t4);case 33:return t.abrupt("return",[]);case 34:case"end":return t.stop()}}),t,null,[[0,30]])})));return function(r){return t.apply(this,arguments)}}()));case 2:return n=t.sent,i={},n.forEach((function(t,r){i[e[r]]=t})),t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function j(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=i(!0),f=a(n,2),m=f[0],h=f[1],v=i({}),b=a(v,2),y=b[0],w=b[1],j=i(!0),x=a(j,2),O=x[0],_=x[1],$=i({}),k=a($,2),P=k[0],E=k[1],S="drilling"===r;return o((function(){function n(){return(n=c(s.mark((function r(){var n,a,c,i,o,f,m;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=(e||Object.values(S?p:l)).filter((function(t){return t.dataSource&&t.dataSource.length})),a=[],n.forEach((function(t){t.dataSource.forEach((function(t){var r=t.provider,e=t.collection,n=t.fields;r&&e&&n&&n.length?n.forEach((function(t){return a.push("".concat(r,"#").concat(e,".").concat(t))})):e&&a.push(e)}))})),r.prev=3,c={asset_id:{$in:t}},i=a.reduce((function(t,r){return t[r]=1,t}),{asset_id:1}),o={aggregate:JSON.stringify([{$match:c},{$project:i}])},r.next=9,u("corva","well_cache",null,o);case 9:f=r.sent,m={},f.forEach((function(t){var r=t.asset_id;m[r]=t})),w(m),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(3),console.error(r.t0);case 18:h(!1);case 19:case"end":return r.stop()}}),r,null,[[3,15]])})))).apply(this,arguments)}function a(){return(a=c(s.mark((function e(){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"drilling"!==r){e.next=7;break}return e.next=4,d(t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,g(t);case 9:e.t0=e.sent;case 10:n=e.t0,E(n),e.next=17;break;case 14:e.prev=14,e.t1=e.catch(0),console.error(e.t1);case 17:_(!1);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}h(!0),_(!0),function(){n.apply(this,arguments)}(),function(){a.apply(this,arguments)}()}),[]),[m||O,y,P]}export{j as useWellSummaryData};
