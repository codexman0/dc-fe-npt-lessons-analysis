import{maxBy as e}from"lodash";import a from"@babel/runtime/helpers/slicedToArray";import{jsx as t,jsxs as l}from"react/jsx-runtime";import{makeStyles as r,Grid as n,FormControl as o,InputLabel as i,Select as s,ListSubheader as c,MenuItem as u}from"@material-ui/core";import{useState as d,useMemo as p,useEffect as v}from"react";import{string as b,func as f,shape as m}from"prop-types";import{isUserDeveloperAdmin as h}from"../../utils/user.js";import g from"./effects/index.js";var R=r({select:{width:250,margin:"8px 0"},group:{fontStyle:"italic",fontWeight:"bold",fontSize:"12px",color:"#999"}}),S=function(r){var b=r.value,f=r.onChange,m=r.appId,S=r.currentUser,_=R(),w=g(m),V=w.isLoading,y=w.packages,C=h(S),D=d(b),x=a(D,2),A=x[0],P=x[1],B=p((function(){var e=[{label:"Stable Release - no stable version",value:"PROD",disabled:!0},{label:"Beta - no beta version",value:"BETA",disabled:!0}],a=[];return y.forEach((function(t){var l=t.attributes,r=l.version,n=l.notes,o=l.label,i=l.status;if(o){var s="PROD"===o?e[0]:e[1];s.label="".concat("PROD"===o?"Stable Release":"Beta"," v").concat(r," ").concat(n?"-  ".concat(n):""),s.disabled=!1}else C&&a.push({label:"v".concat(r," ").concat(n?"-  ".concat(n):""),value:r,status:i})})),{labeled:e,unlabeled:a}}),[y,C]),I=B.labeled,O=B.unlabeled;return v((function(){if(C&&!b){var a=I.find((function(e){return!e.disabled}))||e(O.filter((function(e){return"published"===e.status})),"value");P(null==a?void 0:a.value),f(null==a?void 0:a.value)}}),[I,O]),t(n,{children:l(o,{className:_.select,children:[t(i,{shrink:!(!b&&!A),htmlFor:"appVersion",children:"App Version"}),l(s,{"data-testid":"".concat("DC_versionSelect","_dropdown"),value:b||A,onChange:function(e){f(e.target.value)},autoWidth:!0,disabled:V,label:"App Version",inputProps:{name:"appVersion",id:"appVersion"},children:[C&&t(c,{className:_.group,children:"Labelled Versions (When selected always shows current Beta or Stable Release Versions)"}),I.map((function(e){var a=e.label,l=e.value,r=e.disabled;return t(u,{"data-testid":"".concat("DC_versionSelect","_option_").concat(a,"MenuItem"),value:l,disabled:r,children:a})})),C&&t(c,{className:_.group,children:"Other versions (App will always show selected version until version is deleted)"}),O.map((function(e){var a=e.label,l=e.value;return t(u,{"data-testid":"".concat("DC_versionSelect","_option_").concat(a,"MenuItem"),value:l,children:a})}))]})]})})};S.propTypes={value:b,onChange:f.isRequired,appId:b.isRequired,currentUser:m({}).isRequired},S.defaultProps={value:null};export default S;
