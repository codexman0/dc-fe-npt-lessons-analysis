import e from"@babel/runtime/helpers/defineProperty";import r from"@babel/runtime/helpers/classCallCheck";import t from"@babel/runtime/helpers/createClass";import o from"moment";import{get as i,set as n}from"lodash";import s from"@babel/runtime/regenerator";import a from"@babel/runtime/helpers/asyncToGenerator";import d from"@babel/runtime/helpers/toConsumableArray";import l from"@material-ui/core/colors/grey";import{jsx as u,jsxs as p}from"react/jsx-runtime";import{PureComponent as c}from"react";import h from"prop-types";import m from"classnames";import f from"@babel/runtime/helpers/assertThisInitialized";import y from"@babel/runtime/helpers/inherits";import b from"@babel/runtime/helpers/possibleConstructorReturn";import I from"@babel/runtime/helpers/getPrototypeOf";import g from"react-infinite-scroller";import v from"../LoadingIndicator/LoadingIndicator.js";import L from"./styles.css.js";function T(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,o=I(e);if(r){var i=I(this).constructor;t=Reflect.construct(o,arguments,i)}else t=o.apply(this,arguments);return b(this,t)}}var D=l[700],C={newerThan12Hours:"Last 12 hours",olderThan12Hours:"Last 24 hours",olderThan1Days:"Earlier this week",olderThan7Days:"Older than 7 days",olderThan14Days:"Older than 14 days",olderThan30Days:"Older than 30 days"},w=function(l){y(b,c);var h=T(b);function b(t){var o;return r(this,b),o=h.call(this,t),e(f(o),"loadItems",a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.state.isLoadingByScroll){e.next=2;break}return e.abrupt("return");case 2:return o.setState({isLoadingByScroll:!0}),e.next=5,o.props.loadItems();case 5:o.setState({isLoadingByScroll:!1});case 6:case"end":return e.stop()}}),e)})))),o.state={isLoadingByScroll:!1,periodDates:o.periodDates},o.updatePeriodsIntervalId=null,o}return t(b,[{key:"componentDidMount",value:function(){var e=this;this.updatePeriodsIntervalId=setInterval((function(){return e.setState({periodDates:e.periodDates})}),216e5)}},{key:"componentWillUnmount",value:function(){this.updatePeriodsIntervalId&&clearInterval(this.updatePeriodsIntervalId)}},{key:"renderNoItemsLabel",value:function(){return u("div",{"data-testid":"".concat("generic_infiniteList","_noItems"),className:L.cInfiniteListEmpty,children:this.props.noItemsFoundLabel},"c-infinite-list__empty")}},{key:"renderPeriodSeparator",value:function(e){return u("div",{"data-testid":"".concat("generic_infiniteList","_periodLabel"),className:L.cInfiniteListPeriod,style:{color:D},children:C[e]},e)}},{key:"renderItems",value:function(){var e=this;if(!this.props.divideByPeriods)return this.props.items.map((function(r){return e.props.renderItem(r)})).unshift(this.props.headerComponent);var r=this.state.periodDates,t=r.hoursAgo12,s=r.daysAgo1,a=r.daysAgo7,l=r.daysAgo14,u=r.daysAgo30,p=this.props.items.reduce((function(r,d,p){var c,h=e.props.renderItem(d,p),m=i(d,e.props.pathToCreatedAt),f=o(m);return f>=t?c="newerThan12Hours":f<t&&f>=s?c="olderThan12Hours":f<s&&f>=a?c="olderThan1Days":f<a&&f>=l?c="olderThan7Days":f<l&&f>=u?c="olderThan14Days":f<u&&(c="olderThan30Days"),n(r,[c,r[c].length],h)}),{newerThan12Hours:[],olderThan12Hours:[],olderThan1Days:[],olderThan7Days:[],olderThan14Days:[],olderThan30Days:[]}),c=Object.keys(p).reduce((function(r,t){return 0===p[t].length?r.concat(p[t]):r.concat([e.renderPeriodSeparator(t)].concat(d(p[t])))}),[]);return[this.props.headerComponent].concat(d(c))}},{key:"render",value:function(){return p("div",{className:m(L.cInfiniteList,this.props.infiniteClassName,e({},L.cInfiniteListOverflow,!this.props.useWindow)),style:{height:this.props.infiniteContainerHeight},children:[u(g,{loadMore:this.loadItems,hasMore:this.props.moreItemsMayExist&&!this.props.showNoItemsFound,threshold:this.props.threshold,loader:u(v,{fullscreen:!1},"c-infinite-scroll__loader"),useWindow:this.props.useWindow,initialLoad:this.props.initialLoad,children:this.renderItems()}),this.props.showNoItemsFound&&this.renderNoItemsLabel()]})}},{key:"periodDates",get:function(){return{hoursAgo12:o().subtract(12,"hours"),daysAgo1:o().subtract(1,"days"),daysAgo7:o().subtract(7,"days"),daysAgo14:o().subtract(14,"days"),daysAgo30:o().subtract(30,"days")}}}]),b}();w.propTypes={infiniteClassName:h.string,useWindow:h.bool,headerComponent:h.node,items:h.arrayOf(h.shape()).isRequired,showNoItemsFound:h.bool.isRequired,noItemsFoundLabel:h.string.isRequired,infiniteContainerHeight:h.number,moreItemsMayExist:h.bool.isRequired,pathToCreatedAt:h.arrayOf(h.string).isRequired,renderItem:h.func.isRequired,loadItems:h.func.isRequired,threshold:h.number,initialLoad:h.bool,divideByPeriods:h.bool},w.defaultProps={infiniteClassName:null,useWindow:!1,headerComponent:null,infiniteContainerHeight:null,threshold:3e3,initialLoad:!0,divideByPeriods:!0};export default w;
