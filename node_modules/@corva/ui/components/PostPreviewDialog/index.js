import e from"@babel/runtime/helpers/defineProperty";import t from"@babel/runtime/helpers/classCallCheck";import i from"@babel/runtime/helpers/createClass";import o from"@material-ui/core/colors/grey";import{isNativeDetected as l}from"../../utils/mobileDetect.js";import{jsx as r,jsxs as a}from"react/jsx-runtime";import{Dialog as n}from"@material-ui/core";import{createRef as s,PureComponent as c}from"react";import p from"prop-types";import{withStyles as d}from"@material-ui/core/styles";import m from"@babel/runtime/helpers/assertThisInitialized";import f from"@babel/runtime/helpers/inherits";import h from"@babel/runtime/helpers/possibleConstructorReturn";import u from"@babel/runtime/helpers/getPrototypeOf";import g from"@material-ui/core/Button";import U from"@material-ui/core/Typography";import v from"../UserMention/index.js";import N from"../EmojiIconButton.js";import y from"file-extension";import F from"image-extensions";import b from"@material-ui/core/Paper";import S from"@material-ui/core/DialogActions";import C from"@material-ui/core/DialogContent";import D from"@material-ui/core/DialogTitle";import x from"@material-ui/core/Input";import E from"@material-ui/core/RootRef";import R from"@material-ui/icons/Delete";import P from"../FileTypeIcon.js";import w from"../FailedFileUploading.js";import B from"./styles.css.js";import I from"../FileUploadIconButton.js";function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=u(e);if(t){var l=u(this).constructor;i=Reflect.construct(o,arguments,l)}else i=o.apply(this,arguments);return h(this,i)}}var j="PostPreviewDialog",T=o[200],z=o[300],q=o[400],M=function(e){return a(b,{className:e.classes.messageWrapper,children:[r(x,{"data-testid":"".concat(j,"_messageInput"),inputRef:e.inputEl,inputComponent:v,inputProps:{onChange:e.handleMessageChange,companyId:e.companyId,suggestionsPortalHost:e.rootRef.current},placeholder:"Add a message about the file...",fullWidth:!0,disableUnderline:!0,multiline:!0,rows:"3",className:e.classes.textFieldRoot,value:e.comment,onKeyDown:e.handleKeyDown}),a("div",{className:B.cPostPreviewDialogMessageAdditionalFieldsWrapper,children:[r("div",{children:e.additionalFields}),a("div",{className:B.cPostPreviewDialogMessageActionFields,children:[!e.fileUrl&&r(I,{htmlColor:o[400],openPreviewDialogOnUpload:!1,disableRipple:!0,onFinish:e.handleFileUpload,onError:e.handleFileUploadingError,inputId:"preview-dialog-file-upload"}),r(N,{handleSelectEmoji:e.handleSelectEmoji,emojiIconClassName:e.classes.additionalActionButton,htmlColor:o[400],disableRipple:!0})]})]})]})},W=function(e){var t=y(e.fileName),i=F.includes(t);return a("div",i?{children:[a("div",{className:B.cPostPreviewDialogFileName,children:[r(U,{"data-testid":"".concat(j,"_fileName"),variant:"subtitle2",noWrap:!0,gutterBottom:!0,children:e.fileName}),r(R,{"data-testid":"".concat(j,"_deleteButton"),color:"action",onClick:e.handleFileDelete,className:e.classes.deleteButton})]}),r("div",{className:B.cPostPreviewDialogFileImageFileWrapper,style:{backgroundColor:T,border:"1px solid ".concat(z)},children:r("img",{"data-testid":"".concat(j,"_previewImage"),className:B.cPostPreviewDialogFileImage,src:e.fileUrl,alt:"Uploaded file"})})]}:{className:B.cPostPreviewDialogFileDownload,style:{backgroundColor:T,border:"1px solid ".concat(q)},children:[r(P,{fileName:e.fileName}),a("div",{className:B.cPostPreviewDialogFileDownloadText,children:[r(U,{"data-testid":"".concat(j,"_fileName"),variant:"subtitle2",noWrap:!0,children:e.fileName}),r(R,{"data-testid":"".concat(j,"_deleteButton"),color:"action",onClick:e.handleFileDelete,className:e.classes.deleteButton})]})]})},_=function(o){f(p,c);var l=k(p);function p(i){var o;return t(this,p),o=l.call(this,i),e(m(o),"focusOnInput",(function(){return o.inputEl.current.focus()})),e(m(o),"handleKeyDown",(function(e){"Enter"===e.key&&o.handleShare()})),e(m(o),"handleMessageChange",(function(e){return o.setState({comment:e})})),e(m(o),"handleSelectEmoji",(function(e){return o.setState((function(t){var i=t.comment;return{comment:"".concat(i).concat(e.native)}}))})),e(m(o),"handleShare",(function(){o.props.handleShare(o.state.comment,o.state.fileUrl,o.state.fileSize)})),e(m(o),"handleFileDelete",(function(){o.setState({fileUrl:"",fileSize:null,fileName:""})})),e(m(o),"handleFileUpload",(function(e,t,i){o.setState({fileUrl:e,fileName:t,fileSize:i,fileUploadingError:null})})),e(m(o),"handleFileUploadingError",(function(e){o.setState({fileUrl:null,fileName:null,fileSize:null,fileUploadingError:e})})),o.state={comment:i.message,fileUrl:i.fileUrl,fileSize:i.fileSize,fileName:i.fileName,fileUploadingError:null},o.inputEl=s(),o.rootRef=s(),o}return i(p,[{key:"componentDidUpdate",value:function(e){!e.open&&this.props.open&&!this.state.comment&&this.props.message&&this.setState({comment:this.props.message}),this.props.fileUrl===e.fileUrl&&this.props.fileSize===e.fileSize&&this.props.fileName===e.fileName||this.setState({fileUrl:this.props.fileUrl,fileSize:this.props.fileSize,fileName:this.props.fileName})}},{key:"render",value:function(){return r(E,{rootRef:this.rootRef,children:a(n,{fullScreen:this.props.isNative,open:this.props.open,onClose:this.props.handleClose,onBackdropClick:this.props.handleClose,onEntered:this.focusOnInput,children:[r(D,{children:this.props.title}),a(C,{classes:{root:!this.props.isNative&&this.props.classes.dialogContentRoot},children:[r(M,{inputEl:this.inputEl,comment:this.state.comment,handleMessageChange:this.handleMessageChange,handleKeyDown:this.handleKeyDown,handleFileUpload:this.handleFileUpload,handleSelectEmoji:this.handleSelectEmoji,handleFileUploadingError:this.handleFileUploadingError,additionalFields:this.props.additionalFields,fileUrl:this.state.fileUrl,classes:this.props.classes,companyId:this.props.companyId,rootRef:this.rootRef}),this.state.fileUploadingError&&r(w,{errorMessage:this.state.fileUploadingError,className:this.props.classes.fileUploadingError}),this.state.fileUrl&&r(W,{fileName:this.state.fileName,fileUrl:this.state.fileUrl,handleFileDelete:this.handleFileDelete,handleFileUploadingError:this.handleFileUploadingError,classes:this.props.classes})]}),a(S,{className:this.props.classes.dialogActions,children:[r(g,{"data-testid":"".concat(j,"_cancelButton"),color:"primary",onClick:this.props.handleClose,children:this.props.cancelButtonText}),r(g,{"data-testid":"".concat(j,"_okButton"),color:"primary",variant:"contained",disabled:!this.state.fileUrl&&!this.state.comment||!this.props.requiredFields.every(Boolean),onClick:this.handleShare,children:this.props.okButtonText})]})]})})}}]),p}();_.propTypes={title:p.string,open:p.bool.isRequired,fileUrl:p.string,fileName:p.string,fileSize:p.number,handleShare:p.func.isRequired,handleClose:p.func.isRequired,classes:p.shape({}).isRequired,isNative:p.bool.isRequired,additionalFields:p.arrayOf(p.node),requiredFields:p.arrayOf(p.string),message:p.string,companyId:p.number,okButtonText:p.string,cancelButtonText:p.string},_.defaultProps={title:"Share a file",fileUrl:"",fileName:"",fileSize:null,additionalFields:[],requiredFields:[],message:"",companyId:null,okButtonText:"Post",cancelButtonText:"Cancel",isNative:l};var A=d((function(e){return{dialogContentRoot:{minWidth:500},textFieldRoot:{marginBottom:20},textInput:{paddingTop:2},messageWrapper:{border:"0",boxShadow:"inset 0 0 0 1px rgba(0, 0, 0, 0.23)",padding:"18.5px 14px","&:hover":{boxShadow:"inset 0 0 0 1px ".concat(e.palette.common.black)},"&:focus-within":{boxShadow:"inset 0 0 0 2px ".concat(e.palette.primary.main)}},dialogActions:{padding:"0 24px 24px",margin:0},deleteButton:{cursor:"pointer"},fileUploadingError:{marginTop:10}}}))(_);export default A;
