import e from"@babel/runtime/helpers/defineProperty";import{omit as t,get as n}from"lodash";import i from"@babel/runtime/helpers/slicedToArray";import{jsxs as a,jsx as r,Fragment as o}from"react/jsx-runtime";import{Popover as l,Typography as s,CircularProgress as c,List as m,ListItem as p,TextField as d,IconButton as u}from"@material-ui/core";import{useState as f,useEffect as h,useMemo as g}from"react";import N from"prop-types";import y from"classnames";import{Check as v,AddCircle as T,Layers as S,Close as b,Delete as O,Edit as C,FileCopy as E,Share as I}from"@material-ui/icons";import R from"../TemplateSharingDialog/index.js";import{useTemplatePopoverStyles as q}from"./Styles.js";import P from"./StyledTooltip.js";var j,D;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?L(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var z="USER",w="DEFAULT",U="SHARED",A=(e(j={},z,"No templates yet..."),e(j,w,"No templates yet..."),e(j,U,"No shared templates yet..."),j),B=(e(D={},z,"My Template"),e(D,w,"Default Templates"),e(D,U,"Shared With Me"),D);function W(N){var j=N.currentUser,D=N.open,L=N.anchorEl,W=N.anchorOrigin,x=N.transformOrigin,M=N.onClose,F=N.templates,H=N.activeTemplateName,G=N.activeTemplateId,K=N.getDefaultTemplates,J=N.getUserTemplates,Q=N.getSharedTemplates,V=N.onAddNewTemplate,X=N.onTemplateDelete,Y=N.onTemplateCopy,Z=N.onTemplateEdit,$=N.onTemplateShare,_=N.onActiveTemplateChange,ee=N.loading,te=N.classes,ne=N.hasNameSlot,ie=N.renderSlot,ae=q(),re=f(F),oe=i(re,2),le=oe[0],se=oe[1],ce=f(null),me=i(ce,2),pe=me[0],de=me[1],ue=f({}),fe=i(ue,2),he=fe[0],ge=fe[1];h((function(){se(F)}),[F]);var Ne=g((function(){return[{type:z,templatesList:J(le)},{type:w,templatesList:K(le)},{type:U,templatesList:Q(le)}]}),[le]),ye=function(e,t){return function(n){n.stopPropagation(),t(e)}},ve=function(e){return function(t){t.stopPropagation(),se(le.map((function(t){return t.id===e?k(k({},t),{},{isEditing:!0,prevName:t.name}):t})))}},Te=function(e){return function(n){n.stopPropagation(),se(le.map((function(t){return t.id===e?k(k({},t),{},{isEditing:!1}):t})));var i=le.find((function(t){return t.id===e}));Z(t(i,["prevName","isEditing"]))}},Se=function(e){return function(t){t.stopPropagation(),se(le.map((function(t){return t.id===e?k(k({},t),{},{name:t.prevName,isEditing:!1}):t})))}},be=function(e){return function(n){if("Enter"===n.key){se(le.map((function(t){return t.id===e?k(k({},t),{},{isEditing:!1}):t})));var i=le.find((function(t){return t.id===e}));Z(t(i,["prevName","isEditing"]))}}},Oe=function(e){return function(t){t.stopPropagation();var n=le.find((function(t){return t.id===e}));de(n)}},Ce=function(){de(null)};return a(l,{id:"app-settings-template-popper",classes:{paper:y(ae.paper,te.paper)},open:D,anchorEl:L,onClose:M,anchorOrigin:W,transformOrigin:x,children:[a("div",{className:ae.paperWrapper,children:[a("div",{className:ae.titleWrapper,children:[r(s,{className:ae.title,children:"Templates"}),ee&&r(c,{size:16})]}),a("div",{className:ae.selectedGroup,children:[r(v,{fontSize:"small",className:ae.selectedIcon}),r("div",{className:ae.selectedLabel,children:H})]}),Ne.map((function(t){var i=t.type,l=t.templatesList;return a(o,{children:[a("div",{className:ae.templateHeader,children:[r(s,{className:ae.subtitle,children:B[i]}),i===z&&r(P,{title:"Create",placement:"right",children:r(T,{fontSize:"small",color:"primary",className:ae.addNewTemplateIcon,onClick:V})})]}),0===l.length?r(s,{className:ae.noTemplateLabel,children:A[i]}):r(m,{className:ae.templateList,children:l.map((function(t){var l,c,m;return a(p,{className:y(ae.templateListItem,(l={},e(l,ae.templateListItemSelected,t.id===G),e(l,ae.templateListItemUnSelected,t.id!==G),l)),onClick:(m=t.id,function(){_(m)}),children:[t.id===G?r(v,k({fontSize:"small"},t.isEditing&&{color:"primary"})):r(S,k({fontSize:"small"},t.isEditing&&{color:"primary"})),t.isEditing?r(d,{autoFocus:!0,className:ae.templateListItemInput,value:t.name,onClick:function(e){return e.stopPropagation()},onChange:(c=t.id,function(t){t.stopPropagation(),le.filter((function(e){return e.id!==c})).map((function(e){return e.name})).includes(t.target.value)?ge(k(k({},he),{},e({},c,"Duplicated name"))):ge(k(k({},he),{},e({},c,null))),se(le.map((function(e){return e.id===c?k(k({},e),{},{name:t.target.value}):e})))}),onKeyDown:be(t.id),error:!!he[t.id],helperText:he[t.id]}):r(s,{className:ae.templateListItemName,children:t.name}),t.isEditing?null:ne&&ie(n(t,["settings","data"],[])),t.isEditing?a("div",{className:y(ae.actionWrapper,ae.actionWrapperEditing),children:[r(P,{title:"Save",children:r(u,{className:ae.actionIconButton,onClick:Te(t.id),children:r(v,{fontSize:"small",color:"primary"})})}),r(P,{title:"Cancel",children:r(u,{className:ae.actionIconButton,onClick:Se(t.id),children:r(b,{className:ae.actionIcon,fontSize:"small"})})})]}):r("div",{className:ae.actionWrapper,children:i===z?a(o,{children:[r(P,{title:"Delete",children:r(u,{className:ae.actionIconButton,onClick:ye(t.id,X),children:r(O,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Rename",children:r(u,{className:ae.actionIconButton,onClick:ve(t.id),children:r(C,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Copy",children:r(u,{className:ae.actionIconButton,onClick:ye(t.id,Y),children:r(E,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Share",children:r(u,{className:ae.actionIconButton,onClick:Oe(t.id),children:r(I,{className:ae.actionIcon,fontSize:"small"})})})]}):r(P,{title:"Copy To My Templates",children:r(u,{className:ae.actionIconButton,onClick:ye(t.id,Y),children:r(E,{className:ae.actionIcon,fontSize:"small"})})})})]},t.id)}))})]})}))]}),r(R,{title:'Share "'.concat(n(pe,"name"),'"'),open:!!pe,onSave:function(e){pe&&$(pe.id,e),Ce()},onCancel:Ce,currentUser:j})]})}W.propTypes={open:N.bool.isRequired,anchorEl:N.node.isRequired,anchorOrigin:N.node.isRequired,transformOrigin:N.node.isRequired,onClose:N.func.isRequired,templates:N.arrayOf(N.shape({id:N.number,name:N.string,settings:N.shape({}),shared:N.bool})).isRequired,activeTemplateId:N.number.isRequired,getDefaultTemplates:N.func.isRequired,getUserTemplates:N.func.isRequired,getSharedTemplates:N.func.isRequired,onAddNewTemplate:N.func.isRequired,onTemplateDelete:N.func.isRequired,onTemplateCopy:N.func.isRequired,onTemplateEdit:N.func.isRequired,onTemplateShare:N.func.isRequired,onActiveTemplateChange:N.func.isRequired,loading:N.bool,classes:N.shape({paper:N.string}),hasNameSlot:N.bool,renderSlot:N.func.isRequired,activeTemplateName:N.string.isRequired,currentUser:N.shape({}).isRequired},W.defaultProps={loading:!1,classes:{},hasNameSlot:!1};export default W;
