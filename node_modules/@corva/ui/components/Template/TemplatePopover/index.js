import e from"@babel/runtime/helpers/defineProperty";import{omit as t,get as n}from"lodash";import i from"@babel/runtime/helpers/slicedToArray";import{jsxs as a,jsx as r,Fragment as o}from"react/jsx-runtime";import{Popover as l,Typography as c,CircularProgress as s,List as m,ListItem as p,TextField as d,IconButton as u}from"@material-ui/core";import{useState as f,useEffect as h,useMemo as g}from"react";import N from"prop-types";import y from"classnames";import{Check as v,AddCircle as T,Layers as S,Close as I,Delete as b,Edit as O,FileCopy as C,Share as E}from"@material-ui/icons";import R from"../TemplateSharingDialog/index.js";import{useTemplatePopoverStyles as q}from"./Styles.js";import P from"./StyledTooltip.js";var j,D;function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function L(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?B(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var k="USER",z="DEFAULT",w="SHARED",M=(e(j={},k,"No templates yet..."),e(j,z,"No templates yet..."),e(j,w,"No shared templates yet..."),j),U=(e(D={},k,"My Template"),e(D,z,"Default Templates"),e(D,w,"Shared With Me"),D);function A(N){var j=N.currentUser,D=N.open,B=N.anchorEl,A=N.anchorOrigin,W=N.transformOrigin,x=N.onClose,F=N.templates,H=N.activeTemplateName,G=N.activeTemplateId,K=N.getDefaultTemplates,J=N.getUserTemplates,Q=N.getSharedTemplates,V=N.onAddNewTemplate,X=N.onTemplateDelete,Y=N.onTemplateCopy,Z=N.onTemplateEdit,$=N.onTemplateShare,_=N.onActiveTemplateChange,ee=N.loading,te=N.classes,ne=N.hasNameSlot,ie=N.renderSlot,ae=q(),re=f(F),oe=i(re,2),le=oe[0],ce=oe[1],se=f(null),me=i(se,2),pe=me[0],de=me[1],ue=f({}),fe=i(ue,2),he=fe[0],ge=fe[1];h((function(){ce(F)}),[F]);var Ne=g((function(){return[{type:k,templatesList:J(le)},{type:z,templatesList:K(le)},{type:w,templatesList:Q(le)}]}),[le]),ye=function(e,t){return function(n){n.stopPropagation(),t(e)}},ve=function(e){return function(t){t.stopPropagation(),ce(le.map((function(t){return t.id===e?L(L({},t),{},{isEditing:!0,prevName:t.name}):t})))}},Te=function(e){return function(n){n.stopPropagation(),ce(le.map((function(t){return t.id===e?L(L({},t),{},{isEditing:!1}):t})));var i=le.find((function(t){return t.id===e}));Z(t(i,["prevName","isEditing"]))}},Se=function(e){return function(t){t.stopPropagation(),ce(le.map((function(t){return t.id===e?L(L({},t),{},{name:t.prevName,isEditing:!1}):t})))}},Ie=function(e){return function(n){if("Enter"===n.key){ce(le.map((function(t){return t.id===e?L(L({},t),{},{isEditing:!1}):t})));var i=le.find((function(t){return t.id===e}));Z(t(i,["prevName","isEditing"]))}}},be=function(e){return function(t){t.stopPropagation();var n=le.find((function(t){return t.id===e}));de(n)}},Oe=function(){de(null)};return a(l,{id:"app-settings-template-popper",classes:{paper:y(ae.paper,te.paper)},open:D,anchorEl:B,onClose:x,anchorOrigin:A,transformOrigin:W,children:[a("div",{className:ae.paperWrapper,children:[a("div",{className:ae.titleWrapper,children:[r(c,{className:ae.title,children:"Templates"}),ee&&r(s,{size:16})]}),a("div",{className:ae.selectedGroup,children:[r(v,{fontSize:"small",className:ae.selectedIcon}),r("div",{className:ae.selectedLabel,children:H})]}),Ne.map((function(t){var i=t.type,l=t.templatesList;return a(o,{children:[a("div",{className:ae.templateHeader,children:[r(c,{className:ae.subtitle,children:U[i]}),i===k&&r(P,{title:"Create",placement:"right",children:r(T,{fontSize:"small",color:"primary",className:ae.addNewTemplateIcon,onClick:V})})]}),0===l.length?r(c,{className:ae.noTemplateLabel,children:M[i]}):r(m,{className:ae.templateList,children:l.map((function(t){var l,s,m;return a(p,{className:y(ae.templateListItem,(l={},e(l,ae.templateListItemSelected,t.id===G),e(l,ae.templateListItemUnSelected,t.id!==G),l)),onClick:(m=t.id,function(){_(m)}),children:[t.id===G?r(v,L({fontSize:"small"},t.isEditing&&{color:"primary"})):r(S,L({fontSize:"small"},t.isEditing&&{color:"primary"})),t.isEditing?r(d,{autoFocus:!0,className:ae.templateListItemInput,value:t.name,onClick:function(e){return e.stopPropagation()},onChange:(s=t.id,function(t){t.stopPropagation(),le.filter((function(e){return e.id!==s})).map((function(e){return e.name})).includes(t.target.value)?ge(L(L({},he),{},e({},s,"Duplicated name"))):ge(L(L({},he),{},e({},s,null))),ce(le.map((function(e){return e.id===s?L(L({},e),{},{name:t.target.value}):e})))}),onKeyDown:Ie(t.id),error:!!he[t.id],helperText:he[t.id]}):r(c,{className:ae.templateListItemName,children:t.name}),t.isEditing?null:ne&&ie(n(t,["settings","data"],[])),t.isEditing?a("div",{className:y(ae.actionWrapper,ae.actionWrapperEditing),children:[r(P,{title:"Save",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:Te(t.id),children:r(v,{fontSize:"small",color:"primary"})})}),r(P,{title:"Cancel",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:Se(t.id),children:r(I,{className:ae.actionIcon,fontSize:"small"})})})]}):r("div",{className:ae.actionWrapper,children:i===k?a(o,{children:[r(P,{title:"Delete",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:ye(t.id,X),children:r(b,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Rename",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:ve(t.id),children:r(O,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Copy",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:ye(t.id,Y),children:r(C,{className:ae.actionIcon,fontSize:"small"})})}),r(P,{title:"Share",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:be(t.id),children:r(E,{className:ae.actionIcon,fontSize:"small"})})})]}):r(P,{title:"Copy To My Templates",children:r(u,{"data-not-migrated-MuiIconButton":!0,className:ae.actionIconButton,onClick:ye(t.id,Y),children:r(C,{className:ae.actionIcon,fontSize:"small"})})})})]},t.id)}))})]})}))]}),r(R,{title:'Share "'.concat(n(pe,"name"),'"'),open:!!pe,onSave:function(e){pe&&$(pe.id,e),Oe()},onCancel:Oe,currentUser:j})]})}A.propTypes={open:N.bool.isRequired,anchorEl:N.node.isRequired,anchorOrigin:N.node.isRequired,transformOrigin:N.node.isRequired,onClose:N.func.isRequired,templates:N.arrayOf(N.shape({id:N.number,name:N.string,settings:N.shape({}),shared:N.bool})).isRequired,activeTemplateId:N.number.isRequired,getDefaultTemplates:N.func.isRequired,getUserTemplates:N.func.isRequired,getSharedTemplates:N.func.isRequired,onAddNewTemplate:N.func.isRequired,onTemplateDelete:N.func.isRequired,onTemplateCopy:N.func.isRequired,onTemplateEdit:N.func.isRequired,onTemplateShare:N.func.isRequired,onActiveTemplateChange:N.func.isRequired,loading:N.bool,classes:N.shape({paper:N.string}),hasNameSlot:N.bool,renderSlot:N.func.isRequired,activeTemplateName:N.string.isRequired,currentUser:N.shape({}).isRequired},A.defaultProps={loading:!1,classes:{},hasNameSlot:!1};export default A;
