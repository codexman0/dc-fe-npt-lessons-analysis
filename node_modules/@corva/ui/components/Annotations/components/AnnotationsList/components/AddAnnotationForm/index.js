import t from"@babel/runtime/helpers/defineProperty";import e from"moment";import{flowRight as r,get as n}from"lodash";import o from"@babel/runtime/helpers/slicedToArray";import a from"@babel/runtime/regenerator";import i from"@babel/runtime/helpers/asyncToGenerator";import{jsxs as s,jsx as p}from"react/jsx-runtime";import{Fade as c,Paper as m,Typography as d}from"@material-ui/core";import{memo as u,useState as l,useRef as f}from"react";import{postAnnotation as h}from"../../../../../../clients/jsonApi/index.js";import y from"../../../../../../effects/useOutsideClick.js";import{number as A,shape as b,func as I,string as v}from"prop-types";import _ from"classnames";import{withStyles as N}from"@material-ui/core/styles";import{withRouter as j}from"react-router";import x from"../../../../../Avatar/index.js";import{ADD_ANNOTATION as P}from"../../../../constants.js";import{useAnnotationsDispatch as g}from"../../../../AnnotationsContext.js";import q from"../AnnotationInput/index.js";import C from"./style.css.js";var S=function(r){var u,A=r.appId,b=r.assetId,I=r.assetCompanyId,v=r.appSettings,N=r.currentUser,j=r.classes,S=r.location,T=r.showSuccessNotification,w=r.dashboardType,F=g(),R=l(!1),k=o(R,2),U=k[0],L=k[1],O=f(null);y(O,(function(){L(!1)}));var z,G=(z=i(a.mark((function t(r,o,i){var s,p,c,m;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s={app_id:A,asset_id:b,body:r,active_until:o,attachment:{file_name:i&&i.attachmentName,s3_link:i&&i.attachmentUrl},settings:v},p={},w&&(p.dashboard_type=w),(c=n(S,"query.time"))&&(s.data_timestamp=e(c).format()),t.next=8,h(s,p);case 8:m=t.sent,F({type:P,annotation:m}),t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return");case 16:T("Annotation has been added"),L(!1);case 18:case"end":return t.stop()}}),t,null,[[0,12]])}))),function(t,e,r){return z.apply(this,arguments)});return s("div",{className:C.cAddAnnotationFormInput,children:[p(x,{displayName:"".concat(N.first_name," ").concat(N.last_name),imgSrc:N.profile_photo,size:36}),s("div",{className:_(C.cAddAnnotationFormInputPaper,(u={},t(u,C.cAddAnnotationFormInputPaperOpened,U),t(u,C.cAddAnnotationFormInputPaperClosed,!U),u)),children:[p(c,{in:!U,timeout:500,children:p(m,{className:C.cAddAnnotationFormInputPaperLabel,children:p(d,{variant:"body2","data-testid":"".concat("AppAnnotationsPo","_collapsedInput"),className:j.inputLabel,onClick:function(){return L(!0)},children:"Type annotation here"})})}),p(c,{in:U,timeout:100,children:p("div",{className:C.cAddAnnotationFormInputPaperAddAnnotation,children:U&&p(q,{onSend:G,assetCompanyId:I,currentUser:N})})})]})]})};S.propTypes={appId:A.isRequired,assetId:A.isRequired,assetCompanyId:A.isRequired,appSettings:b().isRequired,currentUser:b({}),classes:b().isRequired,location:b().isRequired,showSuccessNotification:I,dashboardType:v},S.defaultProps={currentUser:{},showSuccessNotification:function(){},dashboardType:null};var T=r([N((function(t){return{inputLabel:{color:t.palette.grey[700],fontWeight:200,width:"100%"}}})),j])(u(S));export default T;
