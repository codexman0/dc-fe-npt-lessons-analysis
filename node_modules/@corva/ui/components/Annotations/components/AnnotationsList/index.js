import t from"@babel/runtime/helpers/defineProperty";import e from"@babel/runtime/helpers/slicedToArray";import n from"@babel/runtime/regenerator";import o from"@babel/runtime/helpers/asyncToGenerator";import{isNativeDetected as a}from"../../../../utils/mobileDetect.js";import{jsx as i,jsxs as r,Fragment as s}from"react/jsx-runtime";import{RootRef as c,Paper as d,Typography as p,Tooltip as m,IconButton as l}from"@material-ui/core";import{memo as u,useRef as f,useState as h,useEffect as y}from"react";import{getAnnotations as b}from"../../../../clients/jsonApi/index.js";import g from"../../../../effects/useOutsideClick.js";import{number as A,string as v,shape as I,func as N,bool as C}from"prop-types";import T from"classnames";import{withStyles as x}from"@material-ui/core/styles";import j from"@material-ui/icons/ChevronLeft";import w from"../../../InfiniteList/index.js";import{SET_ANNOTATIONS as S,APPEND_ANNOTATIONS as L}from"../../constants.js";import{useAnnotationsState as k,useAnnotationsDispatch as R}from"../../AnnotationsContext.js";import _ from"./components/AddAnnotationForm/index.js";import q from"./components/Annotation/index.js";import H from"./style.css.js";var U="AppAnnotationsPo",B=function(a){var u,A=a.appId,v=a.appTitle,I=a.assetId,N=a.assetCompanyId,C=a.appSettings,x=a.currentUser,B=a.onClose,F=a.isNative,O=a.classes,P=a.showSuccessNotification,W=a.dashboardType,M=k().annotations,D=R(),E=f(),G=f();g(E,B);var z=h(!1),J=e(z,2),K=J[0],Q=J[1],V=h(!0),X=e(V,2),Y=X[0],Z=X[1],$=h(!0),tt=e($,2),et=tt[0],nt=tt[1],ot=h(1),at=e(ot,2),it=at[0],rt=at[1];function st(){return(st=o(n.mark((function t(){var e,o,a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A&&I){t.next=2;break}return t.abrupt("return");case 2:return Z(!0),t.prev=3,o={page:it,per_page:4,sort:"created_at",order:"desc"},W&&(o.dashboard_type=W),t.next=8,b(A,I,o);case 8:e=t.sent,D({type:1===it?S:L,annotations:e}),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),console.error(t.t0);case 15:a=e&&e.data.length<4,rt(it+1),nt(!a),Z(!1);case 19:case"end":return t.stop()}}),t,null,[[3,12]])})))).apply(this,arguments)}return y((function(){Q(!0)}),[]),i(c,{rootRef:E,children:r(d,{className:T(H.cAnnotationsList,(u={},t(u,H.cAnnotationsListOpen,K),t(u,H.cAnnotationsListOpenNative,F),u)),children:[i(w,{infiniteClassName:H.cAnnotationsListContentContainer,headerComponent:r(s,{children:[i(p,{"data-testid":"".concat(U,"_appTitle"),variant:"body1",className:O.title,children:v}),i("div",{className:H.cAnnotationsListContentTop,children:r(p,{"data-testid":"".concat(U,"_annotationsTitle"),variant:"caption",className:O.secondaryTitle,children:["Annotations (",M.data?M.data.length:0,")"]})}),i(_,{appId:A,assetId:I,assetCompanyId:N,appSettings:C,currentUser:x,showSuccessNotification:P,dashboardType:W})]}),useWindow:F,items:M.data||[],showNoItemsFound:!(M.data&&0!==M.data.length||Y),noItemsFoundLabel:i(p,{variant:"body2","data-testid":"".concat(U,"_noAnnotations"),className:O.noAnnotations,children:"No Annotations yet"}),threshold:50,infiniteContainerHeight:E.current&&G.current?E.current.clientHeight-G.current.clientHeight:null,moreItemsMayExist:et,pathToCreatedAt:["attributes","created_at"],renderItem:function(t){return i(q,{isNative:F,annotation:t,assetCompanyId:N,included:M.included,currentUser:x,showSuccessNotification:P},t.id)},loadItems:function(){return st.apply(this,arguments)}}),i("div",{className:H.cAnnotationsListActions,ref:G,children:i(m,{title:"Hide",placement:"bottom",children:i(l,{"data-not-migrated-MuiIconButton":!0,"data-testid":"".concat(U,"_hideButton"),onClick:B,className:O.backIcon,children:i(j,{})})})})]})})};B.propTypes={appId:A.isRequired,appTitle:v.isRequired,assetId:A.isRequired,assetCompanyId:A.isRequired,appSettings:I(),classes:I().isRequired,onClose:N.isRequired,showSuccessNotification:N,currentUser:I({}).isRequired,isNative:C,dashboardType:v},B.defaultProps={appSettings:{},isNative:a,showSuccessNotification:function(){},dashboardType:null};var F=x((function(t){return{title:{fontWeight:200,marginBottom:20},secondaryTitle:{fontWeight:200,textTransform:"uppercase",color:t.palette.grey[600]},annotateIcon:{padding:0,"&:hover":{backgroundColor:"transparent",boxShadow:"none"}},noAnnotations:{marginTop:16},backIcon:{cursor:"pointer",color:t.palette.grey[600],padding:5}}}))(u(B));export default F;
