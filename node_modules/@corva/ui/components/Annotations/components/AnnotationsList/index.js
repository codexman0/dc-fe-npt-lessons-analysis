import t from"@babel/runtime/helpers/defineProperty";import e from"@babel/runtime/helpers/slicedToArray";import n from"@babel/runtime/regenerator";import o from"@babel/runtime/helpers/asyncToGenerator";import{isNativeDetected as a}from"../../../../utils/mobileDetect.js";import{jsx as r,jsxs as i,Fragment as s}from"react/jsx-runtime";import{RootRef as c,Paper as p,Typography as d,Tooltip as m,IconButton as l}from"@material-ui/core";import{memo as u,useRef as f,useState as h,useEffect as y}from"react";import{getAnnotations as b}from"../../../../clients/jsonApi/index.js";import g from"../../../../effects/useOutsideClick.js";import{number as A,string as v,shape as N,func as I,bool as C}from"prop-types";import T from"classnames";import{withStyles as x}from"@material-ui/core/styles";import j from"@material-ui/icons/ChevronLeft";import w from"../../../InfiniteList/index.js";import{SET_ANNOTATIONS as S,APPEND_ANNOTATIONS as L}from"../../constants.js";import{useAnnotationsState as k,useAnnotationsDispatch as R}from"../../AnnotationsContext.js";import _ from"./components/AddAnnotationForm/index.js";import q from"./components/Annotation/index.js";import H from"./style.css.js";var U="AppAnnotationsPo",F=function(a){var u,A=a.appId,v=a.appTitle,N=a.assetId,I=a.assetCompanyId,C=a.appSettings,x=a.currentUser,F=a.onClose,O=a.isNative,P=a.classes,W=a.showSuccessNotification,B=a.dashboardType,D=k().annotations,E=R(),G=f(),M=f();g(G,F);var z=h(!1),J=e(z,2),K=J[0],Q=J[1],V=h(!0),X=e(V,2),Y=X[0],Z=X[1],$=h(!0),tt=e($,2),et=tt[0],nt=tt[1],ot=h(1),at=e(ot,2),rt=at[0],it=at[1];function st(){return(st=o(n.mark((function t(){var e,o,a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A&&N){t.next=2;break}return t.abrupt("return");case 2:return Z(!0),t.prev=3,o={page:rt,per_page:4,sort:"created_at",order:"desc"},B&&(o.dashboard_type=B),t.next=8,b(A,N,o);case 8:e=t.sent,E({type:1===rt?S:L,annotations:e}),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),console.error(t.t0);case 15:a=e&&e.data.length<4,it(rt+1),nt(!a),Z(!1);case 19:case"end":return t.stop()}}),t,null,[[3,12]])})))).apply(this,arguments)}return y((function(){Q(!0)}),[]),r(c,{rootRef:G,children:i(p,{className:T(H.cAnnotationsList,(u={},t(u,H.cAnnotationsListOpen,K),t(u,H.cAnnotationsListOpenNative,O),u)),children:[r(w,{infiniteClassName:H.cAnnotationsListContentContainer,headerComponent:i(s,{children:[r(d,{"data-testid":"".concat(U,"_appTitle"),variant:"body1",className:P.title,children:v}),r("div",{className:H.cAnnotationsListContentTop,children:i(d,{"data-testid":"".concat(U,"_annotationsTitle"),variant:"caption",className:P.secondaryTitle,children:["Annotations (",D.data?D.data.length:0,")"]})}),r(_,{appId:A,assetId:N,assetCompanyId:I,appSettings:C,currentUser:x,showSuccessNotification:W,dashboardType:B})]}),useWindow:O,items:D.data||[],showNoItemsFound:!(D.data&&0!==D.data.length||Y),noItemsFoundLabel:r(d,{variant:"body2","data-testid":"".concat(U,"_noAnnotations"),className:P.noAnnotations,children:"No Annotations yet"}),threshold:50,infiniteContainerHeight:G.current&&M.current?G.current.clientHeight-M.current.clientHeight:null,moreItemsMayExist:et,pathToCreatedAt:["attributes","created_at"],renderItem:function(t){return r(q,{isNative:O,annotation:t,assetCompanyId:I,included:D.included,currentUser:x,showSuccessNotification:W},t.id)},loadItems:function(){return st.apply(this,arguments)}}),r("div",{className:H.cAnnotationsListActions,ref:M,children:r(m,{title:"Hide",placement:"bottom",children:r(l,{"data-testid":"".concat(U,"_hideButton"),onClick:F,className:P.backIcon,children:r(j,{})})})})]})})};F.propTypes={appId:A.isRequired,appTitle:v.isRequired,assetId:A.isRequired,assetCompanyId:A.isRequired,appSettings:N(),classes:N().isRequired,onClose:I.isRequired,showSuccessNotification:I,currentUser:N({}).isRequired,isNative:C,dashboardType:v},F.defaultProps={appSettings:{},isNative:a,showSuccessNotification:function(){},dashboardType:null};var O=x((function(t){return{title:{fontWeight:200,marginBottom:20},secondaryTitle:{fontWeight:200,textTransform:"uppercase",color:t.palette.grey[600]},annotateIcon:{padding:0,"&:hover":{backgroundColor:"transparent",boxShadow:"none"}},noAnnotations:{marginTop:16},backIcon:{cursor:"pointer",color:t.palette.grey[600],padding:5}}}))(u(F));export default O;
