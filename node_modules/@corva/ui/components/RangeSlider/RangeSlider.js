import{round as e}from"lodash";import t from"@babel/runtime/helpers/slicedToArray";import{jsxs as n,jsx as i}from"react/jsx-runtime";import{useState as r,useRef as o,useCallback as a,useEffect as c}from"react";import s from"prop-types";import u from"classnames";import l from"./RangeSlider.css.js";var d="left",m="right",f="center",v=function(s){var v=s.leftRange,h=s.rightRange,g=s.minRange,p=s.maxRange,R=s.onChange,x=s.hideDecimals,P=s.resetInt,N=s.onChangeFinish,C=r(0),w=t(C,2),y=w[0],L=w[1],b=r(25),D=t(b,2),E=D[0],B=D[1],z=r({left:0,width:0}),I=t(z,2),q=I[0],M=I[1],T=r(e(v||g,2)),V=t(T,2),W=V[0],F=V[1],j=r(e(h||p,2)),k=t(j,2),O=k[0],X=k[1],A=r(!1),S=t(A,2),G=S[0],H=S[1],J=r(!1),K=t(J,2),Q=K[0],U=K[1],Y=r(0),Z=t(Y,2),$=Z[0],_=Z[1],ee=r(0),te=t(ee,2),ne=te[0],ie=te[1],re=e(g,2),oe=e(p,2),ae=r(null),ce=t(ae,2),se=ce[0],ue=ce[1],le=o(),de=o(),me=o(),fe=o(),ve=o(),he=o(),ge=a((function(e){var t=e&&e.offsetWidth;me.current={containerWidth:t,val2PxRatio:t/(oe-re)},ue((oe-re)/t)}),[re,oe,P]);c((function(){W>=re&&O<=oe&&O-W>=1&&R({left:W,right:O})}),[W,O,re,oe]),c((function(){var e=le.current.getBoundingClientRect().width,t=de.current.getBoundingClientRect().width,n=ve.current.getBoundingClientRect().width,i=n-20<(e+t)/2;(H(i),i)?M({left:y+n/2,width:e+t+6}):M({left:y+6,width:E-y-12})}),[y,E]),c((function(){var t=me.current.val2PxRatio;F(e(v||re,2)),X(e(h||oe,2));var n=t*e(v-re,2),i=t*e((h||oe)-re,2);i-n>=13?(L(n),B(i)):(L(n),B(n+13))}),[P]),c((function(){var e=le.current.getBoundingClientRect().width,t=de.current.getBoundingClientRect().width;ie(e/2+6.5),_(t/2+6.5)}),[W,O]);var pe=function(t){var n=fe.current.startLeftPosition,i=me.current.val2PxRatio,r=ve.current.getBoundingClientRect().width,o=n+t,a=re+o*se;a+1>=O?(a=O-1,o=(O-1-re)*i):o<=0&&(o=0,a=re),(o>=6.5&&r>=13||o<y)&&(L(o),F(e(a,2)))},Re=function(t){var n=fe.current.startRightPosition,i=ve.current.getBoundingClientRect().width,r=me.current,o=r.val2PxRatio,a=r.containerWidth,c=n+t,s=re+c*se;c>=a?(c=a,s=oe):s-1<=W&&(c=(W+1-re)*o,s=W+1),(i>=13||c>E)&&(B(c),X(e(s,2)))},xe=function(t){var n=fe.current,i=n.valueDiff,r=n.startLeftPosition,o=n.startRightPosition,a=me.current,c=a.val2PxRatio,s=a.containerWidth,u=r+t,l=o+t,d=re+u*se,m=d+i;u<=0?(u=0,d=re,m=re+i,l=i*c):l>=s&&(l=s,m=oe,u=((d=oe-i)-re)*c),L(u),B(l),X(e(m,2)),F(e(d,2))},Pe=a((function(e){var t=fe.current,n=t.direction,i=t.event,r=e.clientX-i.clientX;n===d?pe(r):n===m?Re(r):xe(r)}),[pe,Re,xe]);c((function(){function e(){fe.current={inProgress:!1},document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",e),U(!1),N({right:O,left:W})}return Q?(document.addEventListener("mouseup",e),document.addEventListener("mousemove",Pe)):(document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",e)),function(){document.removeEventListener("mousemove",Pe),document.removeEventListener("mouseup",e)}}),[Q,Pe]);var Ne=function(){(W<re||W>=O-1)&&F(re+e(se*y,2)),(O>oe||O<=W+1)&&X(re+e(se*E,2))},Ce=x?e(W):W,we=x?e(O):O;return n("div",{className:l.container,ref:ge,children:[n("div",{className:l.slider,ref:ve,style:{left:"".concat(y,"px"),width:"".concat(E-y,"px")},children:[i("input",{type:"text",size:"".concat(Ce).length||1,value:Ce,ref:le,className:l.hiddenInputRight,readOnly:!0}),i("span",{className:l.leftTrack,onMouseDown:function(e){Ne(),fe.current={event:e,startLeftPosition:y,direction:d,inProgress:!0},U(!0)}}),i("div",{className:l.selectedRange,onMouseDown:function(e){Ne(),fe.current={event:e,startLeftPosition:y,startRightPosition:E,valueDiff:O-W,direction:f,inProgress:!0},U(!0)}}),i("span",{className:l.rightTrack,onMouseDown:function(e){Ne(),fe.current={event:e,startRightPosition:E,direction:m,inProgress:!0},U(!0)}}),i("input",{type:"text",size:"".concat(we).length||1,value:we,ref:de,className:l.hiddenInputLeft,readOnly:!0})]}),n("div",{className:u(l.sliderValues,G&&l.sliderValuesMinimized),ref:he,style:{left:"".concat(q.left,"px"),width:"".concat(q.width,"px")},children:[i("div",{className:l.valuesContainer,style:{left:"-".concat(G?0:ne,"px")},children:i("input",{className:l.inputValue,type:"text",size:"".concat(Ce).length||1,value:Ce,onChange:function(t){var n=e(t.target.value,2);if(!Number.isNaN(n)&&(F(n),n>=re&&n<=O-1)){var i=me.current.val2PxRatio*(n-re);L(E-i>=13?i:E-13),N({right:O,left:n})}}})}),G&&i("span",{className:l.placeholder,children:"â€“"}),i("div",{className:l.valuesContainer,style:{right:"-".concat(G?0:$,"px")},children:i("input",{className:l.inputValue,type:"text",size:"".concat(we).length||1,value:we,onChange:function(t){var n=e(t.target.value,2);if(!Number.isNaN(n)&&(X(n),n<=oe&&n>=W+1)){var i=me.current.val2PxRatio*(n-re);B(i-y>=13?i:y+13),N({right:n,left:W})}},ref:de})})]})]})};v.propTypes={minRange:s.number.isRequired,maxRange:s.number.isRequired,leftRange:s.number.isRequired,rightRange:s.number.isRequired,onChange:s.func,onChangeFinish:s.func,hideDecimals:s.bool,resetInt:s.number},v.defaultProps={onChange:function(){},onChangeFinish:function(){},hideDecimals:!1,resetInt:0};export default v;
