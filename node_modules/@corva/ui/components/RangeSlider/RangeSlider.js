import{round as e}from"lodash";import t from"@babel/runtime/helpers/slicedToArray";import{jsxs as n,jsx as i}from"react/jsx-runtime";import{useState as r,useRef as o,useCallback as a,useEffect as c}from"react";import u from"prop-types";import s from"classnames";import l from"./RangeSlider.css.js";var d="left",f="right",m="center",v=function(u){var v=u.leftRange,g=u.rightRange,h=u.minRange,p=u.maxRange,R=u.onChange,x=u.minDiffRange,P=u.hideDecimals,N=u.resetInt,w=u.onChangeFinish,C=r(0),y=t(C,2),L=y[0],D=y[1],b=r(25),B=t(b,2),E=B[0],z=B[1],I=r({left:0,width:0}),M=t(I,2),q=M[0],T=M[1],V=r(e(v||h,2)),W=t(V,2),F=W[0],j=W[1],k=r(e(g||p,2)),O=t(k,2),X=O[0],A=O[1],S=r(e(v||h,2)),G=t(S,2),H=G[0],J=G[1],K=r(e(g||p,2)),Q=t(K,2),U=Q[0],Y=Q[1],Z=r(!1),$=t(Z,2),_=$[0],ee=$[1],te=r(!1),ne=t(te,2),ie=ne[0],re=ne[1],oe=r(0),ae=t(oe,2),ce=ae[0],ue=ae[1],se=r(0),le=t(se,2),de=le[0],fe=le[1],me=e(h,2),ve=e(p,2),ge=r(null),he=t(ge,2),pe=he[0],Re=he[1],xe=o(),Pe=o(),Ne=o(),we=o(),Ce=o(),ye=o(),Le=a((function(e){var t=e&&e.offsetWidth;Ne.current={containerWidth:t,val2PxRatio:t/(ve-me)},Re((ve-me)/t)}),[me,ve,N]);c((function(){F>=me&&X<=ve&&X-F>=x&&R({left:F,right:X})}),[F,X,me,ve]),c((function(){var e=xe.current.getBoundingClientRect().width,t=Pe.current.getBoundingClientRect().width,n=Ce.current.getBoundingClientRect().width,i=n-20<(e+t)/2;(ee(i),i)?T({left:L+n/2,width:e+t+6}):T({left:L+6,width:E-L-12})}),[L,E]),c((function(){var t=Ne.current.val2PxRatio;j(e(v||me,2)),A(e(g||ve,2));var n=t*e(v-me,2),i=t*e((g||ve)-me,2);i-n>=13?(D(n),z(i)):(D(n),z(n+13))}),[N]),c((function(){J(P?e(F):F),Y(P?e(X):X);var t=xe.current.getBoundingClientRect().width,n=Pe.current.getBoundingClientRect().width;fe(t/2+6.5),ue(n/2+6.5)}),[F,X]);var De=function(t){var n=we.current.startLeftPosition,i=Ne.current.val2PxRatio,r=Ce.current.getBoundingClientRect().width,o=n+t,a=me+o*pe;E-o<13?(o=E-13,a=X-x):a+x>=X?(a=X-x,o=(X-x-me)*i):o<=0&&(o=0,a=me),(o<L||r>=13)&&(D(o),j(e(a,2)))},be=function(t){var n=we.current.startRightPosition,i=Ce.current.getBoundingClientRect().width,r=Ne.current,o=r.val2PxRatio,a=r.containerWidth,c=n+t,u=me+c*pe,s=c-L;c>=a?(c=a,u=ve):s<13?(c=L+13,u=F+x):u-x<=F&&(c=(F+x-me)*o,u=F+x),(i>=13||c>E)&&(z(c),A(e(u,2)))},Be=function(t){var n=we.current,i=n.valueDiff,r=n.startLeftPosition,o=n.startRightPosition,a=Ne.current,c=a.val2PxRatio,u=a.containerWidth,s=r+t,l=o+t,d=me+s*pe,f=d+i;s<=0?(s=0,d=me,f=me+i,l=i*c):l>=u&&(l=u,f=ve,s=((d=ve-i)-me)*c),D(s),z(l),A(e(f,2)),j(e(d,2))},Ee=a((function(e){var t=we.current,n=t.direction,i=t.event,r=e.clientX-i.clientX;n===d?De(r):n===f?be(r):Be(r)}),[De,be,Be]);c((function(){function e(){we.current={inProgress:!1},document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",e),re(!1),w({right:X,left:F})}return ie?(document.addEventListener("mouseup",e),document.addEventListener("mousemove",Ee)):(document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",e)),function(){document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",e)}}),[ie,Ee]);var ze=function(){(F<me||F>=X-x)&&j(me+e(pe*L,2)),(X>ve||X<=F+x)&&A(me+e(pe*E,2))};c((function(){if(F>=me&&F<=X-x){var e=Ne.current.val2PxRatio*(F-me);D(E-e>=13?e:E-13),w({right:X,left:F})}}),[F]);return c((function(){if(X<=ve&&X>=F+x){var e=Ne.current.val2PxRatio*(X-me);z(e-L>=13?e:L+13),w({right:X,left:F})}}),[X]),n("div",{className:l.container,ref:Le,onMouseDown:function(e){return e.stopPropagation()},children:[n("div",{className:l.slider,ref:Ce,style:{left:"".concat(L,"px"),width:"".concat(E-L,"px")},children:[i("input",{type:"text",size:"".concat(H).length||1,value:H,ref:xe,className:l.hiddenInputRight,readOnly:!0}),i("span",{className:l.leftTrack,onMouseDown:function(e){ze(),we.current={event:e,startLeftPosition:L,direction:d,inProgress:!0},re(!0)}}),i("div",{className:l.selectedRange,onMouseDown:function(e){ze(),we.current={event:e,startLeftPosition:L,startRightPosition:E,valueDiff:X-F,direction:m,inProgress:!0},re(!0)}}),i("span",{className:l.rightTrack,onMouseDown:function(e){ze(),we.current={event:e,startRightPosition:E,direction:f,inProgress:!0},re(!0)}}),i("input",{type:"text",size:"".concat(U).length||1,value:U,ref:Pe,className:l.hiddenInputLeft,readOnly:!0})]}),n("div",{className:s(l.sliderValues,_&&l.sliderValuesMinimized),ref:ye,style:{left:"".concat(q.left,"px"),width:"".concat(q.width,"px")},children:[i("div",{className:l.valuesContainer,style:{left:"-".concat(_?0:de,"px")},children:i("input",{className:l.inputValue,type:"text",size:"".concat(H).length||1,value:H,onChange:function(e){var t=e.target.value;Number.isNaN(t)||J(t)},onBlur:function(){var t=e(H,2),n=X-x;return t>n?(J(n),void j(n)):t<me?(J(me),void j(me)):(J(t),void j(t))}})}),_&&i("span",{className:l.placeholder,children:"â€“"}),i("div",{className:l.valuesContainer,style:{right:"-".concat(_?0:ce,"px")},children:i("input",{className:l.inputValue,type:"text",size:"".concat(U).length||1,value:U,onChange:function(e){var t=e.target.value;Number.isNaN(t)||Y(t)},onBlur:function(){var t=e(U,2),n=F+x;return t<n?(Y(n),A(n)):t>ve?(Y(ve),A(ve)):(Y(t),A(t))},ref:Pe})})]})]})};v.propTypes={minRange:u.number.isRequired,maxRange:u.number.isRequired,leftRange:u.number.isRequired,rightRange:u.number.isRequired,onChange:u.func,onChangeFinish:u.func,minDiffRange:u.number,hideDecimals:u.bool,resetInt:u.number},v.defaultProps={onChange:function(){},onChangeFinish:function(){},minDiffRange:1,hideDecimals:!1,resetInt:0};export default v;
