import t from"@babel/runtime/helpers/defineProperty";import{get as n}from"lodash";import e from"@babel/runtime/helpers/slicedToArray";import"@babel/runtime/regenerator";import"@babel/runtime/helpers/asyncToGenerator";import"../../../constants/goals.js";import"../../../constants/apps.js";import"../../../constants/completion.js";import{SEGMENTS as o}from"../../../constants/segment.js";import{displayIntercomIcon as r}from"../../../utils/intercom.js";import"../../../constants/alerts.js";import{isNativeDetected as i,isMobileDetected as s}from"../../../utils/mobileDetect.js";import{jsxs as p,jsx as a,Fragment as m}from"react/jsx-runtime";import{useContext as c,useState as u}from"react";import"querystring";import"uuid/v1";import"../../../clients/jsonApi/index.js";import"../../../clients/subscriptions.js";import l from"../../../effects/useDevCenterApp.js";import g from"classnames";import"../../ErrorBoundary/InternalErrorView/InternalErrorView.js";import d from"../../ErrorBoundary/ErrorBoundary.js";import{AnnotationsProvider as A}from"../../Annotations/AnnotationsContext.js";import f from"../../Annotations/components/AnnotationsList/index.js";import"../../Annotations/components/LastAnnotation/index.js";import j from"../../ErrorBoundary/DevCenterAppErrorView/DevCenterAppErrorView.js";import{DEV_CENTER_CLI_APP_ID as y}from"../../../constants/devcenter.js";import"../../../constants/drillstring.js";import h from"./effects/useAppSettings.js";import C from"./effects/useAnnotationsList.js";import b from"./effects/useAnnotationsData.js";import S from"./components/AppActions/AppActions.js";import v from"./components/AppSettingsDialog/AppSettingsDialog.js";import D from"./components/AnnotationsButton/AnnotationsButton.js";import{getAppVersion as I,getTimestampFromQuery as L}from"./utils.js";import O from"./components/NonPriorityMenus/NonPriorityMenus.js";import w from"./components/FullscreenButton/FullscreenButton.js";import E from"../AppContext.js";import P from"./DevCenterAppContainer.css.js";import x from"./components/RestoreAppSizeButton/index.js";import M from"./components/PriorityMenus/PriorityMenus.js";function B(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function N(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?B(Object(o),!0).forEach((function(e){t(n,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):B(Object(o)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))}))}return n}var q=i||s;function z(t){var s,B,z=t.app,U=t.appId,k=t.currentUser,R=t.coordinates,V=t.onSettingsChange,_=t.onSettingChange,F=t.onAppRemove,T=t.CLIAppComponent,G=t.CLIAppSettings,H=t.currentDashboardAppsLastAnnotations,K=t.updateCurrentDashboardAppLastAnnotation,J=t.maximized,Q=t.location,W=t.isActionsDisabled,X=t.showSuccessNotification,Y=t.layoutEnvironment,Z=c(E),$=u(J),tt=e($,2),nt=tt[0],et=tt[1],ot=u([]),rt=e(ot,2),it=rt[0],st=rt[1],pt=u([]),at=e(pt,2),mt=at[0],ct=at[1],ut=Z&&Z[U||z.id]||{},lt=z.package.manifest.application,gt=n(lt,"segments.0",o.DRILLING),dt=null==lt||null===(s=lt.ui)||void 0===s?void 0:s.multi_rig,At=z.id===y&&q?N(N({},R),{},{w:12}):R,ft=l({CLIAppComponent:T,CLIAppSettings:G,url:z.package.url,appKey:z.app.app_key,version:I(z)}),jt=ft.isLoading,yt=ft.AppSettings,ht=ft.AppComponent,Ct=h(),bt=Ct.isAppSettingsDialogOpened,St=Ct.toggleAppSettingsDialog,vt=C(),Dt=vt.isAnnotationsListOpened,It=vt.toggleAnnotationsList,Lt=jt||!k,Ot=Q.pathname,wt=Q.query,Et=L(null===(B=Q.query)||void 0===B?void 0:B.query),Pt=b({app:z,appData:ut,currentDashboardAppsLastAnnotations:H}),xt=Pt.assetIdForAnnotation,Mt=Pt.assetCompanyId,Bt=Pt.isAppSupportsAnnotations,Nt=Pt.appLastAnnotation;return nt&&r(!1),p("div",{"data-testid":"".concat("DevCenter_AppContainer","_").concat(z.app.name),className:g("dc-app-container",P.container,nt&&P.containerMaximized),children:[p("div",{className:P.containerContent,children:[Lt&&a("div",{children:"Loading"}),!Lt&&ht&&a(d,{ErrorView:j,app:z,withAppHeader:!0,children:a(ht,N(N(N({app:z,coordinates:At},z.settings),ut),{},{currentUser:k,setMainMenuItems:st,setSecondaryMenuItems:ct,onSettingsChange:V,onSettingChange:_,appHeaderProps:N({appLastAnnotation:Nt,updateCurrentDashboardAppLastAnnotation:K,toggleAnnotationsList:It,onSettingChange:_,app:z,currentUser:k,appSettings:z.settings},ut),isNative:i,layoutEnvironment:Y,timestamp:Et}))})]}),bt&&a(v,{toggleAppSettingsDialog:St,onSettingChange:_,onSettingsChange:V,app:z,appData:ut,onAppRemove:F,AppSettingsComponent:yt,currentUser:k,layoutEnvironment:Y,segment:gt,isMultiRig:dt,timestamp:Et}),Dt&&a(A,{children:a(f,{appId:z.app.id,appSettings:z.settings,assetId:xt,assetCompanyId:Mt,appTitle:z.name,onClose:It,currentUser:k,showSuccessNotification:X})}),!W&&nt&&a(x,{currentUser:k,location:Q,onClick:et}),p(S,{toggleAppSettingsDialog:St,children:[Bt&&xt&&a(D,{toggleAnnotationsList:It}),q&&!nt?a(w,{pathname:Ot,query:wt,appId:z.id,setIsMaximized:et}):p(m,{children:[a(M,{menuItems:it}),a(O,{toggleAppSettingsDialog:St,appId:z.id,maximized:nt,setIsMaximized:et,pathname:Ot,query:wt,menuItems:mt})]})]})]})}export default z;
