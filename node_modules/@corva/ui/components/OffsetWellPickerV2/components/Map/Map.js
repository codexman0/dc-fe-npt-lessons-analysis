import r from"@babel/runtime/helpers/defineProperty";import{get as e,sortBy as t}from"lodash";import o from"@babel/runtime/helpers/slicedToArray";import{mapbox as i}from"../../../../utils/index.js";import{jsx as n,jsxs as a}from"react/jsx-runtime";import{darkTheme as l}from"../../../../config/theme/index.js";import"highcharts";import"highcharts/highcharts-more";import"highcharts-multicolor-series";import"highcharts/modules/solid-gauge";import"highcharts/modules/heatmap";import"highcharts/modules/boost";import"highcharts/modules/exporting";import"highcharts/modules/xrange";import"highcharts/modules/dumbbell";import"highcharts/modules/pattern-fill";import"@babel/runtime/helpers/typeof";import{memo as c,useRef as s,useMemo as u,useEffect as m,createElement as p}from"react";import f from"prop-types";import{MuiThemeProvider as d}from"@material-ui/core/styles";import h from"react-dom";import b from"mapbox.js";import{usePrevious as F}from"../../effects/index.js";import g from"./Map.css.js";function v(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,o)}return t}function y(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}var j=i.isValidCoordinates,O=["#FF00FF","#F5BD80","#FF0000","#0080FF","#FF8000","#58ACFA","#FA58F4","#40FF00","#4B8A08","#40FF00","#D8F781"],k=[29.749907,-95.358421];function N(i){var c=i.subjectWell,f=i.wells,v=i.offsetWells,N=i.radius,P=i.subjectWellMarkerSize,w=i.wellMarkerSize,x=i.popUpFormatter,S=i.coordsDataPath,W=s(null),C=s(null),D=s(null),M=F(f),z=u((function(){return f.filter((function(r){return!c||c.id!==r.id}))}),[c,f]),T=u((function(){return c&&e(c,S)}),[c,S]),L=u((function(){var e=[],o=!1;z.forEach((function(r){"Null"===r.formation?o=!0:c&&c.formation===r.formation||e.includes(r.formation)||e.push(r.formation)}));var i=c?[c.formation].concat(t(e)):t(e);o&&!i.includes("Null")&&i.push("Null");var n=i.reduce((function(e,t,o){return y(y({},e),{},r({},t,O[o%O.length]))}),{});return[i,n]}),[c,z]),B=o(L,2),E=B[0],I=B[1];return m((function(){W.current=b.mapbox.map(W.current,null,{attributionControl:!1,scrollWheelZoom:!1,zoomControl:!1}).setView(k,1),b.control.zoom({position:"bottomright"}).addTo(W.current),b.mapbox.styleLayer("mapbox://styles/mapbox/dark-v9").addTo(W.current)}),[]),m((function(){W.current&&(C.current&&W.current.removeLayer(C.current),T?(C.current=b.circle(T,1609.34*N,{stroke:!1,fill:!0,fillOpacity:.2,fillColor:"#03BCD4",className:"circle_500"}),C.current.addTo(W.current)):C.current=null)}),[N,T]),m((function(){if(W.current){W.current.closePopup(),D.current&&D.current.removeFrom(W.current);var r=v.map((function(r){return r.id})),t=[];f.forEach((function(o){var i=e(o,S);if(i&&j(i)){var a=c&&c.id===o.id,s=r.includes(o.id),u=a?P:w,m=a||s?"#00FFFF":I[o.formation],f=a||s?1:.3,F=b.circleMarker(i,{radius:u,stroke:!1,fill:!0,fillOpacity:f,fillColor:m,className:"circle_500"});F.addEventListener("mouseover",(function(){if(x){var r=document.createElement("div"),e=p(x,{well:o,color:I[o.formation]});h.render(n(d,{theme:l,children:e}),r),b.popup().setLatLng(i).setContent(r).openOn(W.current)}})),t.push(F)}})),t.length&&(D.current=b.featureGroup(t),D.current.addTo(W.current)),setTimeout((function(){C.current&&C.current.bringToBack(),D.current&&f!==M&&W.current.fitBounds(D.current.getBounds())}),500)}}),[c,f,v,I]),a("div",{className:g.map,children:[n("div",{className:g.mapMain,ref:W}),a("div",{className:g.mapFooter,children:[v&&a("div",{className:g.mapFooterItem,children:[n("div",{className:g.mapFooterItemSquare,style:{backgroundColor:"#00FFFF"}}),n("div",{className:g.mapFooterItemLabel,children:"Selected Offset Wells"})]}),E.map((function(r){return a("div",{className:g.mapFooterItem,children:[n("div",{className:g.mapFooterItemSquare,style:{backgroundColor:I[r]}}),n("div",{className:g.mapFooterItemLabel,children:r})]},r)}))]})]})}N.propTypes={subjectWell:f.shape({id:f.number,formation:f.string}),wells:f.arrayOf(f.shape({})).isRequired,offsetWells:f.arrayOf(f.shape({})),radius:f.number.isRequired,subjectWellMarkerSize:f.number,wellMarkerSize:f.number,popUpFormatter:f.func,coordsDataPath:f.string},N.defaultProps={subjectWell:null,subjectWellMarkerSize:10,wellMarkerSize:5,popUpFormatter:null,coordsDataPath:"settings.top_hole.coordinates",offsetWells:null};var P=c(N);export default P;
