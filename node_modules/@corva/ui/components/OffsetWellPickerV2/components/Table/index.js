import e from"@babel/runtime/helpers/defineProperty";import r from"moment";import{isEqual as t,clone as i,get as n}from"lodash";import l from"@babel/runtime/helpers/toConsumableArray";import{getUnitDisplay as o,convertValue as a}from"../../../../utils/index.js";import{jsxs as s,Fragment as c,jsx as u}from"react/jsx-runtime";import{withStyles as d,Typography as f,Checkbox as m,IconButton as p}from"@material-ui/core";import{memo as h,useMemo as b}from"react";import g from"prop-types";import y from"classnames";import{AutoSizer as v,Table as w,Column as C}from"react-virtualized";import{METRICS_LIST as x,TABLE_COLUMNS as W,SETTINGS_COLUMN as k,METRICS_KEYS as O}from"../../constants.js";import N from"@material-ui/icons/Sort";import R from"@material-ui/icons/NotInterested";import{SizeMe as j}from"react-sizeme";import I from"./SubjectIndicator.js";import S from"./MetricsAddMenu.js";import _ from"./MetricsSelect.js";import D from"./WellSearch.js";function T(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,i)}return t}function q(r){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach((function(t){e(r,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))}))}return r}var z=48,A=44;function M(e,t){var i,l=n(e,t);switch(t){case"distance":i=Number.isFinite(l)?parseFloat(l).toFixed(2):"N/A";break;case"rigReleaseDate":i=Number.isFinite(l)?r.unix(l).format("MM/DD/YYYY"):"N/A";break;default:i=l||""}return i}function B(r){var d=r.subjectWell,h=r.wells,g=r.offsetWells,j=r.metricsKeys,T=r.isMetricsLoading,z=r.sortInfo,A=r.unusableWellAlarm,B=r.dialogWidth,L=r.classes,P=r.onChangeMetricsKeys,K=r.onAddOffsetWell,F=r.onDeleteOffsetWell,Y=r.onAddAllOffsetWells,E=r.onDeleteAllOffsetWells,H=r.onSorting,V=b((function(){return h.filter((function(e){return e.is_usable}))}),[h]),G=b((function(){return d?h.filter((function(e){return e.id!==d.id})):h}),[d,h]),X=b((function(){var e=V.map((function(e){return e.id})).sort(),r=g.map((function(e){return e.id})).sort();return e.length&&t(e,r)}),[V,g]),$=b((function(){return j.reduce((function(e,r){return e.concat(x.filter((function(e){return e.key===r})))}),[])}),[j]),J=b((function(){return[].concat(l(W),l($.map((function(e){return q(q({},e),{},{width:240})}))),[k])}),[$]),Q=b((function(){if(!B||B<=0)return{};var e={},r=[];return J.filter((function(e){return Number.isFinite(e.width)})).forEach((function(t){e[t.key]=t.width-1,r.push(t.width-1)})),J.filter((function(e){return!Number.isFinite(e.width)})).forEach((function(t){var i=r.reduce((function(e,r){return e+r}),0),n=Math.floor((B-i)/(J.length-r.length)),l=t.minWidth||200,o=n<l?l:n;e[t.key]=o-1,r.push(o-1)})),e}),[B,J]),U=b((function(){return Object.values(Q).reduce((function(e,r){return e+r}),0)}),[Q]),Z=function(e){P(e)},ee=function(e){e.target.checked?Y():E()},re=function(r){return u(p,{className:L.sortIconButton,onClick:function(){return function(e){H(e)}(r)},children:r!==z.key?u(R,{className:L.sortIcon}):u(N,{className:y(L.sortIcon,e({},L.ascendingSortIcon,1===z.direction))})})},te=function(e){var r,t=e.label,n=e.dataKey;if("name"===n)return s("div",{className:L.nameWrapper,children:[u(m,{classes:{checked:L.nameCheckBox,indeterminate:L.nameCheckBox},onClick:ee,checked:X,indeterminate:g.length&&!X,size:"small"}),u(f,{className:y(L.cell,L.nameCell),children:t}),re(n)]});if(j.includes(n)){var l=$.find((function(e){return e.key===n})),a=$.findIndex((function(e){return e.key===n}));return s("div",{className:L.metricsColumn,children:[u(_,{items:x,currentValue:n,onChange:(r=a,function(e){var t=i(j);t[r]=e,P(t)})}),u(f,{className:y(L.cell,L.unitCell),children:l.unitType?"(".concat(o(l.unitType,l.to),")"):""}),re(n)]})}return n===k.key?u("div",{className:L.settingsCell,children:u(S,{metricsKeys:j,onChange:Z})}):s("div",{className:L.nameWrapper,children:[u(f,{className:L.cell,children:t}),re(n)]})},ie=function(r){var t=r.rowData,i=r.dataKey;if("name"===i)return s("div",{className:L.nameWrapper,children:[u(m,{color:"primary",checked:g.findIndex((function(e){return e.id===t.id}))>-1,onChange:function(e){return r=t.id,void(e.target.checked?K(r):F(r));var r},size:"small",disabled:!t.is_usable}),u(f,{className:y(L.tableCellLabel,e({},L.tableCellLabelDisabled,!t.is_usable)),children:M(t,i)}),d&&t.id===d.id&&u(I,{})]});if(i===k.key)return u("div",{className:L.settingsCell,children:!t.is_usable&&u(f,{className:L.errorMsg,children:A})});var l=null;if(j.includes(i)){var o=$.find((function(e){return e.key===i}));l=function(e,r,t){var i=n(e,r.key);if(O.includes(r.key)){if(Number.isFinite(i)||i)return r.unitType?a(i,r.unitType,r.from,r.to):i;if(t)return"loading..."}return""}(t,o,T)}else l=M(t,i);return u(f,{className:y(L.cell,L.tableCellLabel,e({},L.tableCellLabelDisabled,!t.is_usable)),children:l})};return s(c,{children:[u("div",{children:s("div",{className:L.title,children:[u("div",{className:L.tableTitleItems,children:s(f,{variant:"subtitle2",className:L.tableTitle,children:["Wells (",g.length,")"]})}),u("div",{className:L.addWellInput,children:u(D,{wells:G,onChange:function(e){K(e)}})})]})}),u("div",{className:L.tableWrapper,children:u(v,{children:function(e){var r=e.height;return u(w,{width:U,height:r,headerHeight:44,rowHeight:48,rowCount:h.length,rowGetter:function(e){var r=e.index;return h[r]},className:L.table,children:J.map((function(e){return u(C,{width:Q[e.key]||200,dataKey:e.key,label:e.label,headerRenderer:te,cellRenderer:ie},e.key)}))})}})})]})}B.propTypes={subjectWell:g.shape({id:g.number}),wells:g.arrayOf(g.shape({})).isRequired,offsetWells:g.arrayOf(g.shape({})).isRequired,metricsKeys:g.arrayOf(g.string).isRequired,isMetricsLoading:g.bool.isRequired,sortInfo:g.shape({key:g.string.isRequired,direction:g.number.isRequired}).isRequired,classes:g.shape({}).isRequired,onChangeMetricsKeys:g.func.isRequired,onAddOffsetWell:g.func.isRequired,onDeleteOffsetWell:g.func.isRequired,onAddAllOffsetWells:g.func.isRequired,onDeleteAllOffsetWells:g.func.isRequired,onSorting:g.func.isRequired,unusableWellAlarm:g.string.isRequired,dialogWidth:g.number.isRequired},B.defaultProps={subjectWell:null};var L=d((function(e){return{title:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",marginBottom:"10px"},tableWrapper:{overflowX:"auto",overflowY:"hidden",position:"relative",height:200,minHeight:150,borderTop:"1px solid rgba(81, 81, 81, 1)"},table:{"& .ReactVirtualized__Table__headerRow":{textTransform:"none",borderBottom:e.isLightTheme?"1px solid rgba(224, 224, 224, 1)":"1px solid rgba(81, 81, 81, 1)"},"& .ReactVirtualized__Table__row":{borderBottom:e.isLightTheme?"1px solid rgba(224, 224, 224, 1)":"1px solid rgba(81, 81, 81, 1)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},"& .ReactVirtualized__Table__Grid":{outline:"none"},"& .ReactVirtualized__Table__headerColumn":{outline:"none"}},cell:{color:"rgba(255, 255, 255, 0.54)",padding:"5px 10px",fontSize:"12px",whiteSpace:"nowrap"},nameWrapper:{display:"flex",alignItems:"center"},nameCell:{padding:0},unitCell:{padding:0},tableRowHoverEnabled:{"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},settingsCell:{textAlign:"right"},rigReleaseCell:{whiteSpace:"nowrap"},nameCheckBox:{color:e.palette.primary.main},bodyCell:{fontSize:"0.90rem",padding:"5px 10px"},metricsCellWrapper:{display:"flex",flexDirection:"row",alignContent:"center"},tableTitle:{fontSize:"16px",lineHeight:"140.6%",marginTop:10},tableTitleItems:{display:"flex",flexDirection:"row",alignItems:"center"},addWellInput:{width:300,marginTop:10},sortIconButton:{padding:"8px","&:hover $sortIcon":{color:"#fff"}},ascendingSortIcon:{transform:"scaleY(-1)"},sortIcon:{fontSize:"14px",color:"#BDBDBD"},metricsColumn:{display:"flex",alignItems:"center"},tableCellLabel:{fontSize:"0.90rem",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",color:"#fff"},tableCellLabelDisabled:{color:"#C4C4C4"},errorMsg:{color:"#C4C4C4",fontStyle:"italic",fontSize:"14px",padding:"0 16px",whiteSpace:"nowrap"}}}))(h((function(e){return u(j,{monitorWidth:!0,children:function(r){var t=r.size;return u(B,q({dialogWidth:t.width},e))}})})));export default L;export{A as HEADER_HEIGHT,z as ROW_HEIGHT};
