import e from"@babel/runtime/helpers/defineProperty";import{orderBy as n,uniq as t}from"lodash";import o from"@babel/runtime/helpers/slicedToArray";import r from"@babel/runtime/helpers/toConsumableArray";import{jsxs as l,jsx as i,Fragment as s}from"react/jsx-runtime";import{makeStyles as c,Dialog as a,DialogTitle as u,Typography as d,Tooltip as f,IconButton as m,DialogContent as p,DialogActions as b,Button as g}from"@material-ui/core";import y from"@material-ui/icons/Close";import{memo as h,useState as W,useMemo as j,useEffect as I,useCallback as O}from"react";import S from"prop-types";import v from"classnames";import{useTheme as C}from"@material-ui/core/styles";import x from"../LoadingIndicator/LoadingIndicator.js";import A from"@material-ui/core/useMediaQuery";import{DEFAULT_SETTINGS as w}from"./constants.js";import D from"./components/Filter/index.js";import k from"./effects/biDirectionalFiltering.js";import{useCompanies as P,useWells as R,useCompanyMetricKey as B,useFilteredWells as T,useWellsWithCoords as U,useOffsetWells as M,useMetricsData as N}from"./effects/index.js";import q from"./components/Map/index.js";import E from"./components/Table/index.js";function F(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function K(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?F(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):F(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}var L=c({dialogTitles:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:20},closeIconButton:{fontSize:20,padding:4,"&:hover $closeIcon":{color:"#fff"}},closeIcon:{color:"#BDBDBD"},dialogActions:{boxShadow:"0px -4px 10px rgba(0, 0, 0, 0.25)",paddingTop:8,paddingBottom:8},dialogActionsSmallScreen:{paddingRight:"100px"},dialogContent:{display:"flex",flexDirection:"column"}}),_=function(c){var h=c.isOpen,S=c.offsetSetting,F=c.currentUser,_=c.defaultSubjectWellId,z=c.onClose,H=c.onSave,Q=c.addWellsUsabilityInfo,$=c.unusableWellAlarm,G=L(),J=C(),V=A(J.breakpoints.down("sm")),X=("admin"===F.role||"developeradmin"===F.role)&&"corva"===F.company.provider,Y=W(S.companyId||+F.company_id),Z=o(Y,2),ee=Z[0],ne=Z[1],te=W(S.subjectWellId||_),oe=o(te,2),re=oe[0],le=oe[1],ie=W(S.filters||w.filters),se=o(ie,2),ce=se[0],ae=se[1],ue=W(S.radius||w.radius),de=o(ue,2),fe=de[0],me=de[1],pe=W([]),be=o(pe,2),ge=be[0],ye=be[1],he=W(S.addedWellIds||[]),We=o(he,2),je=We[0],Ie=We[1],Oe=W(S.excludedWellIds||[]),Se=o(Oe,2),ve=Se[0],Ce=Se[1],xe=W(w.sortInfo),Ae=o(xe,2),we=Ae[0],De=Ae[1],ke=W(!1),Pe=o(ke,2),Re=Pe[0],Be=Pe[1],Te=j((function(){return!!re}),[re]),Ue=P(X),Me=R(ee,Q),Ne=B(ee);I((function(){ye((function(e){return Ne?[Ne]:e}))}),[Ne]);var qe=k(ce,Me),Ee=T(ce,Me),Fe=j((function(){return Ee&&re?Ee.find((function(e){return e.id===re})):null}),[Ee,re]),Ke=U(Ee,Fe),Le=M(fe,Me,Ke,je,ve),_e=N(ee,Ke),ze=o(_e,2),He=ze[0],Qe=ze[1],$e=j((function(){return Qe?n(Qe,we.key,1===we.direction?"asc":"desc"):Qe}),[we,Qe]),Ge=O((function(e){ne(e),le(null),Ie([]),Ce([]),ae(w.filters)}),[]),Je=O((function(e){var n=Ee.find((function(n){return n.id===e}));if(n&&n.is_usable){var t=ve.filter((function(n){return n!==e}));t.length===ve.length||Ce(t),Ie((function(n){return n.includes(e)?n:[].concat(r(n),[e])}))}}),[ve,Ee]),Ve=O((function(e){var n=je.filter((function(n){return n!==e}));n.length===je.length||Ie(n),Ce((function(n){return n.includes(e)?n:[].concat(r(n),[e])}))}),[je]),Xe=O((function(){Ie(Ee.filter((function(e){return e.is_usable})).map((function(e){return e.id}))),Ce([])}),[Ee]),Ye=O((function(){Ce(Ee.map((function(e){return e.id}))),Ie([])}),[Ee]),Ze=O((function(e){Ie([]),Ce([]),le(e)}),[]),en=O((function(){Ie([]),Ce([]),le(null)}),[]),nn=O((function(e){me(e)}),[]),tn=O((function(n,t){ae((function(o){return K(K({},o),{},e({},n,t))})),Ce([]),Ie([])}),[]),on=O((function(){ae(w.filters),Ce([]),Ie([])}),[]),rn=O((function(){Be((function(e){return!e}))}),[]),ln=O((function(e){ye(e)}),[]),sn=O((function(e){De((function(n){return n.key===e?K(K({},n),{},{direction:-1*n.direction}):{key:e,direction:1}}))}),[]),cn=!(Me&&Ee&&Ke&&Qe&&Le&&$e);return l(a,{onBackdropClick:z,onEscapeKeyDown:z,maxWidth:"lg",fullWidth:!0,fullScreen:V,open:h,children:[i(u,{children:l("div",{className:G.dialogTitles,children:[i(d,{className:G.title,children:"Select Offset Wells"}),i(f,{title:"Close",children:i(m,{"data-not-migrated-MuiIconButton":!0,"aria-label":"close",className:G.closeIconButton,onClick:z,children:i(y,{className:G.closeIcon})})})]})}),i(p,{className:G.dialogContent,children:cn?i(x,{fullscreen:!1}):l(s,{children:[i(D,{companyId:ee,companies:Ue,isCurrentUserCorvaAdmin:X,radius:fe,wells:Ee,subjectWell:Fe,filters:ce,filtersOptions:qe,mapHidden:Re,isRadiusEditable:Te,onChangeCompany:Ge,onSetSubjectWell:Ze,onChangeRadius:nn,onChangeFilters:tn,onClearFilters:on,onToggleMap:rn}),i(q,{subjectWell:Fe,wells:Ee,offsetWells:Le,radius:fe,mapHidden:Re,onSetSubjectWell:Ze,onRemoveSubjectWell:en,onAddOffsetWell:Je,onDeleteOffsetWell:Ve}),i(E,{subjectWell:Fe,wells:$e,offsetWells:Le,metricsKeys:ge,sortInfo:we,isMetricsLoading:He,unusableWellAlarm:$,onChangeMetricsKeys:ln,onSorting:sn,onAddOffsetWell:Je,onDeleteOffsetWell:Ve,onAddAllOffsetWells:Xe,onDeleteAllOffsetWells:Ye})]})}),l(b,{className:v(G.dialogActions,e({},G.dialogActionsSmallScreen,V)),children:[i(g,{onClick:z,color:"primary",children:"Cancel"}),i(g,{variant:"contained",color:"primary",onClick:function(){var e={companyId:ee,subjectWellId:re,addedWellIds:t(je),radius:fe,filters:ce,excludedWellIds:t(ve),selectedWellIds:Le.map((function(e){return e.id}))};console.log(e),H(e,Le)},children:"Save"})]})]})};_.propTypes={isOpen:S.bool.isRequired,offsetSetting:S.shape({}).isRequired,currentUser:S.shape({}).isRequired,defaultSubjectWellId:S.number,onSave:S.func.isRequired,onClose:S.func.isRequired,addWellsUsabilityInfo:S.func,unusableWellAlarm:S.string},_.defaultProps={defaultSubjectWellId:null,addWellsUsabilityInfo:null,unusableWellAlarm:"Unable to add"};var z=h(_);export default z;
