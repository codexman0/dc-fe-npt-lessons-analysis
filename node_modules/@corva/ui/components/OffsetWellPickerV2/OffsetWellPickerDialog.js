import e from"@babel/runtime/helpers/defineProperty";import{get as n,orderBy as t,uniq as l}from"lodash";import r from"@babel/runtime/helpers/slicedToArray";import i from"@babel/runtime/helpers/toConsumableArray";import{jsxs as o,jsx as s,Fragment as c}from"react/jsx-runtime";import{makeStyles as a,Dialog as d,DialogTitle as u,Typography as f,Tooltip as m,IconButton as p,DialogContent as b,DialogActions as g,Button as h}from"@material-ui/core";import y from"@material-ui/icons/Close";import{memo as W,useState as j,useMemo as O,useEffect as I,useCallback as S}from"react";import v from"prop-types";import C from"classnames";import{useTheme as x}from"@material-ui/core/styles";import A from"../LoadingIndicator/LoadingIndicator.js";import D from"@material-ui/core/useMediaQuery";import{DEFAULT_SETTINGS as w}from"./constants.js";import k from"./components/Filter/index.js";import P from"./effects/biDirectionalFiltering.js";import{useCompanies as R,useWells as B,useCompanyMetricKey as T,useFilteredWells as U,useWellsWithCoords as q,useOffsetWells as N,useMetricsData as F}from"./effects/index.js";import M from"./components/Map/index.js";import E from"./components/TableTabs/index.js";function K(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function L(n){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?K(Object(l),!0).forEach((function(t){e(n,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):K(Object(l)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(l,e))}))}return n}var _=a({dialogTitles:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:20},closeIconButton:{fontSize:20,padding:4,"&:hover $closeIcon":{color:"#fff"}},closeIcon:{color:"#BDBDBD"},dialogActions:{boxShadow:"0px -4px 10px rgba(0, 0, 0, 0.25)",paddingTop:8,paddingBottom:8},dialogActionsSmallScreen:{paddingRight:"100px"},dialogContent:{display:"flex",flexDirection:"column"}}),z=function(a){var W=a.isOpen,v=a.offsetSetting,K=a.selectedBicWells,z=a.currentUser,H=a.defaultSubjectWellId,Q=a.onClose,$=a.onSave,G=a.addWellsUsabilityInfo,J=a.unusableWellAlarm,V=_(),X=x(),Y=D(X.breakpoints.down("sm")),Z=("admin"===n(z,"role")||"developeradmin"===n(z,"role"))&&"corva"===n(z,["company","provider"]),ee=j(n(v,"companyId")||+n(z,"company_id")),ne=r(ee,2),te=ne[0],le=ne[1],re=j(n(v,"subjectWellId")||H),ie=r(re,2),oe=ie[0],se=ie[1],ce=j(n(v,"filters")||w.filters),ae=r(ce,2),de=ae[0],ue=ae[1],fe=j(n(v,"radius")||w.radius),me=r(fe,2),pe=me[0],be=me[1],ge=j([]),he=r(ge,2),ye=he[0],We=he[1],je=j(n(v,"addedWellIds")||[]),Oe=r(je,2),Ie=Oe[0],Se=Oe[1],ve=j(n(v,"excludedWellIds")||[]),Ce=r(ve,2),xe=Ce[0],Ae=Ce[1],De=j(w.sortInfo),we=r(De,2),ke=we[0],Pe=we[1],Re=j(!1),Be=r(Re,2),Te=Be[0],Ue=Be[1],qe=O((function(){return!!oe}),[oe]),Ne=R(Z),Fe=B(te,G),Me=T(te);I((function(){We((function(e){return Me?[Me]:e}))}),[Me]);var Ee=P(de,Fe),Ke=U(de,Fe),Le=O((function(){return Ke&&oe?Ke.find((function(e){return e.id===oe})):null}),[Ke,oe]),_e=q(Ke,Le),ze=N(pe,Fe,_e,Ie,xe),He=F(te,_e),Qe=r(He,2),$e=Qe[0],Ge=Qe[1],Je=O((function(){return Ge?t(Ge,ke.key,1===ke.direction?"asc":"desc"):Ge}),[ke,Ge]),Ve=S((function(e){le(e),se(null),Se([]),Ae([]),ue(w.filters)}),[]),Xe=S((function(e){var n=Ke.find((function(n){return n.id===e}));if(n&&n.is_usable){var t=xe.filter((function(n){return n!==e}));t.length===xe.length||Ae(t),Se((function(n){return n.includes(e)?n:[].concat(i(n),[e])}))}}),[xe,Ke]),Ye=S((function(e){var n=Ie.filter((function(n){return n!==e}));n.length===Ie.length||Se(n),Ae((function(n){return n.includes(e)?n:[].concat(i(n),[e])}))}),[Ie]),Ze=S((function(){Se(Ke.filter((function(e){return e.is_usable})).map((function(e){return e.id}))),Ae([])}),[Ke]),en=S((function(){Ae(Ke.map((function(e){return e.id}))),Se([])}),[Ke]),nn=S((function(e){Se([]),Ae([]),se(e)}),[]),tn=S((function(){Se([]),Ae([]),se(null)}),[]),ln=S((function(e){be(e)}),[]),rn=S((function(n,t){ue((function(l){return L(L({},l),{},e({},n,t))})),Ae([]),Se([])}),[]),on=S((function(){ue(w.filters),Ae([]),Se([])}),[]),sn=S((function(){Ue((function(e){return!e}))}),[]),cn=S((function(e){We(e)}),[]),an=S((function(e){Pe((function(n){return n.key===e?L(L({},n),{},{direction:-1*n.direction}):{key:e,direction:1}}))}),[]),dn=!(Fe&&Ke&&_e&&Ge&&ze&&Je);return o(d,{onBackdropClick:Q,onEscapeKeyDown:Q,maxWidth:"lg",fullWidth:!0,fullScreen:Y,open:W,children:[s(u,{children:o("div",{className:V.dialogTitles,children:[s(f,{className:V.title,children:"Select Offset Wells"}),s(m,{title:"Close",children:s(p,{"aria-label":"close",className:V.closeIconButton,onClick:Q,children:s(y,{className:V.closeIcon})})})]})}),s(b,{className:V.dialogContent,children:dn?s(A,{fullscreen:!1}):o(c,{children:[s(k,{companyId:te,companies:Ne,isCurrentUserCorvaAdmin:Z,radius:pe,wells:Ke,subjectWell:Le,filters:de,filtersOptions:Ee,mapHidden:Te,isRadiusEditable:qe,onChangeCompany:Ve,onSetSubjectWell:nn,onChangeRadius:ln,onChangeFilters:rn,onClearFilters:on,onToggleMap:sn}),s(M,{subjectWell:Le,wells:Ke,offsetWells:ze,radius:pe,mapHidden:Te,onSetSubjectWell:nn,onRemoveSubjectWell:tn,onAddOffsetWell:Xe,onDeleteOffsetWell:Ye}),s(E,{bicWells:K,subjectWell:Le,sortedFilteredWells:Je,offsetWells:ze,metricsKeys:ye,sortInfo:ke,isMetricsLoading:$e,unusableWellAlarm:J,handleChangeMetricsKeys:cn,handleSorting:an,handleAddOffsetWell:Xe,handleDeleteOffsetWell:Ye,handleAddAllOffsetWells:Ze,handleDeleteAllOffsetWells:en})]})}),o(g,{className:C(V.dialogActions,e({},V.dialogActionsSmallScreen,Y)),children:[s(h,{onClick:Q,color:"primary",children:"Cancel"}),s(h,{variant:"contained",color:"primary",onClick:function(){var e=L(L({},v),{},{companyId:te,subjectWellId:oe,addedWellIds:l(Ie),radius:pe,filters:de,excludedWellIds:l(xe),selectedWellIds:ze.map((function(e){return e.id}))});$(e,ze)},children:"Save"})]})]})};z.propTypes={isOpen:v.bool.isRequired,offsetSetting:v.shape({}).isRequired,selectedBicWells:v.shape({}).isRequired,currentUser:v.shape({}).isRequired,defaultSubjectWellId:v.number,onSave:v.func.isRequired,onClose:v.func.isRequired,addWellsUsabilityInfo:v.func,unusableWellAlarm:v.string},z.defaultProps={defaultSubjectWellId:null,addWellsUsabilityInfo:null,unusableWellAlarm:"Unable to add"};var H=W(z);export default H;
