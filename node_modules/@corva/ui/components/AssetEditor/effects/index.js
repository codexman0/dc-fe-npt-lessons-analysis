import t from"@babel/runtime/helpers/defineProperty";import"lodash/set";import"lodash/get";import"moment";import"lodash";import e from"@babel/runtime/helpers/slicedToArray";import r from"@babel/runtime/regenerator";import n from"@babel/runtime/helpers/asyncToGenerator";import"@babel/runtime/helpers/toConsumableArray";import{useState as o,useEffect as a,useRef as s}from"react";import"lodash/unset";import"../../../clients/api/apiCore.js";import"../../../clients/constants.js";import{mapAssetGetRequest as i}from"../../../clients/jsonApi/index.js";import"../../../clients/subscriptions.js";import"uuid";import{PER_PAGE as c}from"../constants.js";function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?p(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=function(t){return{sort:"name",order:"asc",fields:["".concat(t,".name"),"".concat(t,".asset_id")]}},f=function(t){return u(u({},t.attributes),{},{id:+t.id})};function m(s,c,p,m){var b=o([]),d=e(b,2),h=d[0],y=d[1],O=o(!0),j=e(O,2),g=j[0],v=j[1];return a((function(){function e(){return(e=n(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(s)(u(u({},l(s)),{},t({per_page:1e4},p,m)));case 2:n=e.sent,y(n.data.map(f)),v(!1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}v(!0),function(){e.apply(this,arguments)}()}),[s,c,p,m]),{assets:h,loading:g}}function b(t){var p=t.assetType,m=t.companyId,b=t.currentValue,d=t.isMultiple,h=t.parentAssetId,y=t.parentAssetType,O=t.scrollPage,j=t.searchText,g=t.setCurrentOption,v=o([]),w=e(v,2),x=w[0],P=w[1],k=o(!1),A=e(k,2),T=A[0],D=A[1],C=s();return a((function(){function t(){return(t=n(r.mark((function t(){var e;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i(p)(u(u({},l(p)),{},{ids:d?b:[b]}));case 2:e=t.sent,g((function(){if(d)return e.data.map(f);var t=e.data[0];return t?f(t):null}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(d?b.length:b)&&function(){t.apply(this,arguments)}()}),[]),a((function(){function t(){return(t=n(r.mark((function t(){var e,n,o,a;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,D(!0),e={per_page:c,page:O},y&&h&&(e[y]=h),m&&(e.company=m),j&&(e.search=j),t.next=8,i(p)(u(u({},l(p)),e));case 8:n=t.sent,o=n.data.map(f),a=C.current!==p||1===O,P(a?o:function(t){return t.concat(o)}),C.current=p,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.error(t.t0);case 18:D(!1);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[p,y,h,m,j,O]),{assets:x,loading:T}}export{b as useAssetAutoCompleteSelectData,m as useAssetSelectData};
