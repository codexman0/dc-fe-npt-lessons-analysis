import e from"@babel/runtime/helpers/defineProperty";import{debounce as t,identity as r}from"lodash";import n from"@babel/runtime/helpers/slicedToArray";import{jsxs as o,jsx as i}from"react/jsx-runtime";import{withStyles as a,List as s,FormControl as l,InputLabel as p,FormHelperText as c,Typography as d,TextField as u,InputAdornment as f}from"@material-ui/core";import{forwardRef as m,useState as b,useEffect as h,useMemo as g}from"react";import y from"@babel/runtime/helpers/objectWithoutProperties";import O from"prop-types";import{Search as x}from"@material-ui/icons";import v from"../TruncatedText/index.js";import{PER_PAGE as T,SCROLL_THRESHOLD as I}from"./constants.js";import{useAssetAutoCompleteSelectData as j}from"./effects/index.js";import{Autocomplete as P}from"@material-ui/lab";function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?A(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S="DC_SingleAssetEditorAutocomplete",w={paddingLeft:"16px",height:36,listStyleType:"none",display:"flex",alignItems:"center"},L=function(e){var t=e.text;return i("li",{style:w,children:i(d,{variant:"body2",color:"textSecondary",children:t})},"loading")};L.defaultProps={text:"Loading..."};var N=m((function(e,t){var r=e.children,n=e.loading,a=e.hasMore,l=y(e,["children","loading","hasMore"]);return o(s,C(C({},l),{},{ref:t,role:"listbox",children:[r,(a||n)&&i(L,{})]}))})),R=function(e){var a=e.label,s=e.currentValue,d=e.isNullable,m=e.onChange,y=e.classes,O=e.parentAssetId,A=e.parentAssetType,w=e.assetType,R=e.companyId,D=e.errorText,V=e["data-testid"],E=e.disabled,M=b(null),_=n(M,2),q=_[0],z=_[1],H=b(""),k=n(H,2),B=k[0],W=k[1],F=b(""),G=n(F,2),J=G[0],K=G[1],Q=b(!1),U=n(Q,2),X=U[0],Y=U[1],Z=b(1),$=n(Z,2),ee=$[0],te=$[1],re=b(!0),ne=n(re,2),oe=ne[0],ie=ne[1];h((function(){z(null),te(1),Y(!1)}),[w]);var ae=j({assetType:w,currentValue:s,parentAssetType:A,parentAssetId:O,scrollPage:ee,companyId:R,searchText:B,setCurrentOption:z}),se=ae.assets,le=ae.loading;h((function(){var e=se.length>=T*ee;ie(e)}),[se,ee]);var pe=g((function(){return t((function(e){te(1),W(e)}),200)}),[]),ce=g((function(){return t((function(){return te((function(e){return e+1}))}),250)}),[]),de={root:y.root,inputRoot:y.inputRoot,popupIndicator:y.popupIndicator,option:y.option,noOptions:y.noOptions,listbox:y.listbox};return o(l,{disabled:E,error:D,className:y.formControl,children:[!d&&i(p,{shrink:!0,children:a}),i(P,{disabled:E,blurOnSelect:!0,classes:de,clearOnBlur:!0,clearOnEscape:!0,"data-testid":V,disableClearable:!0,filterOptions:r,getOptionLabel:function(e){return null==e?void 0:e.name},getOptionSelected:function(e,t){return e&&t&&e.id===t.id},inputValue:X?J:(null==q?void 0:q.name)||"",ListboxComponent:N,ListboxProps:{onScroll:function(e){if(oe&&!le){var t=e.currentTarget;t.scrollTop+t.clientHeight>t.scrollHeight-I&&ce()}},loading:le,hasMore:oe},options:se,onChange:function(e,t){z(t),m(null==t?void 0:t.id)},onClose:function(){K(""),W(""),Y(!1),te(1)},onInputChange:function(e,t,r){"input"===r?(K(t),Y(!0),pe(t)):W("")},noOptionsText:i(L,{text:le?"Loading...":"No options"}),renderInput:function(e){return i(u,C(C({},e),{},{variant:"standard",placeholder:"Search for asset...",InputProps:C(C({},e.InputProps),{},{startAdornment:i(f,{children:i(x,{className:y.searchIcon})})})}))},renderOption:function(e){return i(v,{"data-testid":"".concat(S,"_option_").concat(e.name,"MenuItem"),children:e.name},e.id)},value:q}),i(c,{children:D})]})};R.defaultProps={label:"Choose An Asset",currentValue:void 0,isNullable:!1,parentAssetId:void 0,parentAssetType:void 0,companyId:void 0,errorText:"","data-testid":"".concat(S,"_autoComplete"),disabled:!1},R.propTypes={label:O.string,currentValue:O.number,isNullable:O.bool,onChange:O.func.isRequired,classes:O.shape({}).isRequired,parentAssetId:O.number,parentAssetType:O.string,companyId:O.number,assetType:O.string.isRequired,errorText:O.string,"data-testid":O.string,disabled:O.bool};var D=a({formControl:{},listbox:{maxHeight:350},root:{fontSize:16},inputRoot:{paddingTop:16,padding:"8px 0",paddingBottom:0,width:350,fontSize:16},popupIndicator:{display:"none"},option:{paddingLeft:"16px !important",height:36},noOptions:{padding:0},searchIcon:{fontSize:"20px !important"}})(R);export default D;
