import r from"@babel/runtime/helpers/defineProperty";import{range as t}from"lodash";import e from"@babel/runtime/helpers/toConsumableArray";import{jsx as n,Fragment as i,jsxs as o}from"react/jsx-runtime";import{useContext as a,useRef as c,useMemo as s}from"react";import m from"prop-types";import p from"classnames";import u from"uuid";import{DEFAULT_TRACK_SETTINGS as f}from"../constants.js";import d from"../AddEditTrack.js";import l from"../SettingsContext.js";import g from"../DataContext.js";import b from"./TraceHeader.js";import h from"./ChartContainer.js";import j from"./Track.css.js";function y(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.push.apply(e,n)}return e}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}var O=function(m){var y,O=m.id,P=m.index,x=a(l),C=x.horizontal,k=x.settingsKey,S=x.settings,w=x.onSettingsChange,D=x.maxTracesCount,T=x.multipleAssets,A=a(g).mapping,E=c(),N=s((function(){return O?S[k].find((function(r){return r.id===O})):f}),[O,S,k]),z=function(t){var e=S[k].map((function(r){return O===r.id?v(v({},r),{},{traces:r.traces&&r.traces.filter((function(r){return r.id!==t}))}):r}));w(v(v({},S),{},r({},k,e)))},K=function(t){var n=[];n=t.id?N.traces.map((function(r){return r.id===t.id?t:r})):[].concat(e(N.traces),[v(v({},t),{},{id:u()})]);var i=S[k].map((function(r){return O===r.id?v(v({},r),{},{traces:n}):r}));w(v(v({},S),{},r({},k,i)))},q=function(){E.current.click()},H=s((function(){if(!T)return N.name;var r=A.find((function(r){var t,e;return r.key===(null===(t=N.traces)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.key)}));return r?r.name:N.name}),[N.traces,N.name,T]);return n(i,{children:o("div",{className:p(j.container,(y={},r(y,j.horizontal,C),r(y,j.vertical,!C),y)),children:[n(d,{mapping:A,settings:S,onSettingsChange:w,settingsKey:k,id:O,multipleAssets:T,children:n("div",{className:j.header,ref:E,children:n("div",{className:j.title,children:H})})}),!T&&t(D).map((function(r){return n(b,{index:r,traceSettings:N.traces[r],onDelete:z,mapping:A,onChange:K,openTrackSettings:q},N.traces[r]?N.traces[r].id:r)})),n(h,{traces:N.traces,trackIndex:P})]})})};O.propTypes={id:m.string,index:m.number.isRequired},O.defaultProps={id:""};export default O;
